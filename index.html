<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<title>Eldev documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Eldev</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of contents</div>
<ul class="sectlevel1">
<li><a href="#_brief_overview">Brief overview</a>
<ul class="sectlevel2">
<li><a href="#example-projects">Example projects</a></li>
</ul>
</li>
<li><a href="#requirements">Requirements</a></li>
<li><a href="#installation">Installation</a>
<ul class="sectlevel2">
<li><a href="#_upgrading_eldev">Upgrading Eldev</a></li>
</ul>
</li>
<li><a href="#_safety_concerns">Safety concerns</a></li>
<li><a href="#_getting_started">Getting started</a></li>
<li><a href="#_initializing_a_project">Initializing a project</a>
<ul class="sectlevel2">
<li><a href="#githooks">Initializing a checkout</a></li>
</ul>
</li>
<li><a href="#setup-procedure">Setup procedure in details</a>
<ul class="sectlevel2">
<li><a href="#project-isolation">Project isolation</a></li>
<li><a href="#_using_preinstalled_dependencies">Using preinstalled dependencies</a></li>
</ul>
</li>
<li><a href="#dependencies">Project dependencies</a>
<ul class="sectlevel2">
<li><a href="#local-dependencies">Local dependencies</a></li>
<li><a href="#additional-dependencies">Additional dependencies</a></li>
<li><a href="#_examining_dependencies">Examining dependencies</a></li>
<li><a href="#_upgrading_dependencies">Upgrading dependencies</a></li>
<li><a href="#development-tool-sources">Development tool sources</a></li>
<li><a href="#global-cache">Global package archive cache</a></li>
</ul>
</li>
<li><a href="#loading-modes">Loading modes</a>
<ul class="sectlevel2">
<li><a href="#autoloads">Autoloads</a></li>
</ul>
</li>
<li><a href="#build-system">Build system</a>
<ul class="sectlevel2">
<li><a href="#_targets">Targets</a></li>
<li><a href="#packaging">Building packages</a></li>
<li><a href="#_byte_compiling">Byte-compiling</a></li>
<li><a href="#cleaning">Cleaning</a></li>
</ul>
</li>
<li><a href="#testing">Testing</a>
<ul class="sectlevel2">
<li><a href="#frameworks">Frameworks</a></li>
<li><a href="#multiple-frameworks">Multiple frameworks in one project</a></li>
<li><a href="#_loading_test_files">Loading test files</a></li>
<li><a href="#test-results">Reusing previous test results</a></li>
<li><a href="#testing-simplifications">Testing command line simplifications</a></li>
</ul>
</li>
<li><a href="#linting">Linting</a>
<ul class="sectlevel2">
<li><a href="#doctor">The doctor</a></li>
</ul>
</li>
<li><a href="#evaluating">Quickly evaluating expressions</a></li>
<li><a href="#running-emacs">Running Emacs</a></li>
<li><a href="#profiling">Profiling</a>
<ul class="sectlevel2">
<li><a href="#profiling-eval">Useful evaluation options</a></li>
</ul>
</li>
<li><a href="#different-emacs-versions">Executing on different Emacs versions</a>
<ul class="sectlevel2">
<li><a href="#docker">Using Docker</a></li>
</ul>
</li>
<li><a href="#continuous-integration">Continuous integration</a>
<ul class="sectlevel2">
<li><a href="#github-workflows">GitHub workflows</a></li>
<li><a href="#travis-ci">Travis CI</a></li>
<li><a href="#circle-ci">CircleCI</a></li>
<li><a href="#_script_commands">Script commands</a></li>
</ul>
</li>
<li><a href="#debugging-features">Debugging features</a>
<ul class="sectlevel2">
<li><a href="#_debugging_output">Debugging output</a></li>
<li><a href="#_preventing_accidental_commits">Preventing accidental commits</a></li>
<li><a href="#_debugging_setup_scripts">Debugging setup scripts</a></li>
</ul>
</li>
<li><a href="#_plugins">Plugins</a>
<ul class="sectlevel2">
<li><a href="#autoloads-plugin">autoloads</a></li>
<li><a href="#maintainer-plugin">maintainer</a></li>
<li><a href="#undercover-plugin">undercover</a></li>
</ul>
</li>
<li><a href="#filesets">Filesets</a>
<ul class="sectlevel2">
<li><a href="#simple-filesets">Simple filesets</a></li>
<li><a href="#composite-filesets">Composite filesets</a></li>
<li><a href="#_evaluated_filesets">Evaluated filesets</a></li>
<li><a href="#modifying-filesets">Modifying filesets</a></li>
</ul>
</li>
<li><a href="#extending-eldev">Extending Eldev</a>
<ul class="sectlevel2">
<li><a href="#hooks">Hooks</a></li>
<li><a href="#_writing_builders">Writing builders</a></li>
<li><a href="#_adding_commands_and_options">Adding commands and options</a></li>
<li><a href="#_custom_test_runners">Custom test runners</a></li>
</ul>
</li>
<li><a href="#_influential_environment_variables">Influential environment variables</a></li>
<li><a href="#_see_also">See also</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<!-- toc disabled -->
<div class="paragraph">
<p>Eldev (Elisp development tool) is an Emacs-based build tool, targeted
solely at Elisp projects.  It is an alternative to Cask.  Unlike Cask,
Eldev itself is fully written in Elisp and its configuration files are
also Elisp programs.  If you are familiar with Java world, Cask can be
seen as a parallel to Maven — it uses project <em>description</em>, while
Eldev is sort of a parallel to Gradle — its configuration is a
<em>program</em> on its own.</p>
</div>
<div class="paragraph">
<p><span class="image"><a class="image" href="http://www.gnu.org/licenses/gpl-3.0.txt"><img src="https://img.shields.io/badge/license-GPL_3-green.svg" alt="License: GPL 3"></a></span>
<span class="image"><a class="image" href="https://github.com/doublep/eldev/releases"><img src="https://img.shields.io/github/release/doublep/eldev.svg" alt="Latest release"></a></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_brief_overview">Brief overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Eldev features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Eldev configuration is Elisp.  It can change many defaults, add
special cases for Emacs versions and much more — even define
additional Eldev commands and options.</p>
</li>
<li>
<p>Built-in <a href="#testing">support for regression/unit testing</a>.</p>
</li>
<li>
<p>Blends nicely into <a href="#continuous-integration">continuous
integration</a> setups.</p>
</li>
<li>
<p>Can run on <a href="#different-emacs-versions">different Emacs version</a> even
on the same machine; can also use <a href="#docker">Docker</a> for that.</p>
</li>
<li>
<p>There are <a href="#setup-procedure"><em>four</em> levels of configuration</a> — you
can customize most aspects of Eldev for your project needs and
personal preferences.</p>
</li>
<li>
<p><a href="#dependencies">Project dependency</a> downloading, installation etc.
is fully automated, you only need to specify which Elisp package
archive(s) to use.</p>
</li>
<li>
<p>You can also use <a href="#local-dependencies">local dependencies</a>, even
those that don’t use Eldev (some restrictions still apply).  This
is similar to Cask linking, but with more flexibility.</p>
</li>
<li>
<p>Full support for <a href="#autoloads">autoloads</a> during development.</p>
</li>
<li>
<p>Miscellaneous operations useful during development:
<a href="#running-emacs">running Emacs</a> with only your project,
<a href="#linting">linting</a> source code, <a href="#evaluating">evaluating
expressions</a> in project’s context, <a href="#profiling">profiling</a>.</p>
</li>
<li>
<p>Can <a href="#maintainer-plugin">automate release process</a> for your project.</p>
</li>
<li>
<p>Eldev by default <a href="#project-isolation">isolates</a> your project for
development, helping you to distinguish between problems with setup
or configuration and inherent bugs in the project.</p>
</li>
<li>
<p>Full-featured <a href="#build-system">build system</a> for complex projects.</p>
</li>
<li>
<p>Can <a href="#debugging-features">help you debug your code</a>.</p>
</li>
<li>
<p><a href="#requirements">Runs on all major operating systems</a>: Linux, macOS,
Windows.</p>
</li>
<li>
<p>Eldev is fast.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Drawbacks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Eldev doesn’t run the project being tested/built in a separate
process, so it is not as pure as Cask.  However, Emacs packages
won’t live in a sterile world anyway: typical user setup will
include dozens of other packages.</p>
</li>
<li>
<p>Eldev depends much more on Emacs internals.  It is more likely to
break with future Emacs versions than Cask.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Eldev is not widely used, but as of August 2022 there are
<a href="https://github.com/search?q=filename%3AEldev+path%3A%2F">around 120 projects on GitHub</a> that include file
<code>Eldev</code>, so it is already quite well tested in the wild.
Additionally, Eldev contains a fairly large regression test
collection.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you are using <a href="https://www.flycheck.org/">Flycheck</a>, check out
<a href="https://github.com/flycheck/flycheck-eldev">flycheck-eldev</a> package.  It provides integration
between Flycheck and Eldev, allowing the former to automatically use
proper dependencies in Eldev projects.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="example-projects">Example projects</h3>
<div class="paragraph">
<p>Here is a non-exhaustive list of projects that use Eldev and can serve
as examples.  I intentionally list only my own projects, even if there
are others, because this way it’s easier to ensure that the comments
below stay valid.  Eldev source code itself comes with no examples: I
think real-world usage provides better models.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="https://github.com/doublep/extmap"><code>extmap</code></a>; its file <a href="https://github.com/doublep/extmap/blob/master/Eldev"><code>Eldev</code></a>; its file <a href="https://github.com/doublep/extmap/blob/master/.github/workflows/test.yml"><code>.github/workflows/test.yml</code></a></dt>
<dd>
<p>A simple project with no dependencies.  As you can see, there is
nothing in its <code>Eldev</code>.  The file is actually not even needed, it
is only there to signify that Eldev can be used on the project and
for some tools (<a href="https://github.com/flycheck/flycheck-eldev">flycheck-eldev</a>,
<a href="https://github.com/bbatsov/projectile">Projectile</a>).</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/doublep/iter2"><code>iter2</code></a>; its file <a href="https://github.com/doublep/iter2/blob/master/Eldev"><code>Eldev</code></a>; its file <a href="https://github.com/doublep/iter2/blob/master/.github/workflows/test.yml"><code>.github/workflows/test.yml</code></a></dt>
<dd>
<p>Another simple project with no dependencies.  However, it uses its
file <code>Eldev</code> to define a custom option that activates
project-specific development assistance code.  Additionally, it
enables <a href="#undercover-plugin">undercover</a> plugin to collect test
code coverage statistics.</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/doublep/logview">Logview</a>; its file <a href="https://github.com/doublep/logview/blob/master/Eldev"><code>Eldev</code></a>; its file <a href="https://github.com/doublep/logview/blob/master/.github/workflows/test.yml"><code>.github/workflows/test.yml</code></a></dt>
<dd>
<p>This project has several dependencies, so it needs to instruct
Eldev how to find them.</p>
</dd>
<dt class="hdlist1"><a href="https://github.com/doublep/datetime"><code>datetime</code></a>; its file <a href="https://github.com/doublep/datetime/blob/master/Eldev"><code>Eldev</code></a>; its file <a href="https://github.com/doublep/datetime/blob/master/.github/workflows/test.yml"><code>.github/workflows/test.yml</code></a></dt>
<dd>
<p>A library with a fairly complicated file <code>Eldev</code>.  The main reason
for complexity are two included Java programs that are used for 1)
extracting information from Java core libraries; and 2) comparing
<code>datetime</code>’s results against a Java implementation during
testing.  It also uses <code>extmap</code> to generate resource files that
are later included in its package.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>All these projects also use <a href="#continuous-integration">continuous
integration</a> on <a href="#github-workflows">GitHub</a> for automated testing.
Various elements of files <code>Eldev</code> in these projects are documented
below.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="requirements">Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Eldev runs on Emacs 24.4 and up.  On earlier Emacs versions it will be
overly verbose, but this is rather an Emacs problem.</p>
</div>
<div class="paragraph">
<p>Any “typical” OS — Linux, macOS, Windows or any POSIX-like system not
listed earlier — will do.  Additionally, since there is only a small
shell script (<code>.bat</code> file for Windows) that is really OS-dependent,
porting to other systems should not be difficult, volunteers welcome.</p>
</div>
<div class="paragraph">
<p>Eldev intentionally has no dependencies, at least currently: otherwise
your project would also see them, which could in theory lead to some
problems.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installation">Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are several ways to install Eldev.</p>
</div>
<h4 id="_bootstrapping_from_melpa_if_you_have_a_catch_all_directory_for_executables" class="discrete">Bootstrapping from MELPA: if you have a catch-all directory for executables</h4>
<div class="ulist">
<ul>
<li>
<p>On Linux, macOS, etc.:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From this directory (e.g. <code>~/bin</code>) execute:</p>
<div class="openblock">
<div class="content">
<div class="literalblock">
<div class="content">
<pre>$ curl -fsSL https://raw.github.com/doublep/eldev/master/bin/eldev &gt; eldev &amp;&amp; chmod a+x eldev</pre>
</div>
</div>
<div class="paragraph">
<p>You can even do this from <code>/usr/local/bin</code> provided you have the
necessary permissions.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>On Windows:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From this directory (e.g. <code>%USERPROFILE%\bin</code>) execute:</p>
<div class="openblock">
<div class="content">
<div class="literalblock">
<div class="content">
<pre>&gt; curl.exe -fsSL https://raw.github.com/doublep/eldev/master/bin/eldev.bat &gt; eldev.bat</pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>No further steps necessary — Eldev will bootstrap itself as needed on
first invocation.</p>
</div>
<h4 id="_bootstrapping_from_melpa_general_case" class="discrete">Bootstrapping from MELPA: general case</h4>
<div class="ulist">
<ul>
<li>
<p>On Linux, macOS, etc.:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Execute:</p>
<div class="openblock">
<div class="content">
<div class="literalblock">
<div class="content">
<pre>$ curl -fsSL https://raw.github.com/doublep/eldev/master/webinstall/eldev | sh</pre>
</div>
</div>
<div class="paragraph">
<p>This will install <code>eldev</code> script to <code>~/.local/bin</code>.</p>
</div>
</div>
</div>
</li>
<li>
<p>Generally, <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">this directory should already be in your
<code>PATH</code></a>.  But if not, e.g. in <code>~/.profile</code> add this:</p>
<div class="literalblock">
<div class="content">
<pre>export PATH="$HOME/.local/bin:$PATH"</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>On Windows:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Execute:</p>
<div class="openblock">
<div class="content">
<div class="literalblock">
<div class="content">
<pre>&gt; curl.exe -fsSL https://raw.github.com/doublep/eldev/master/webinstall/eldev.bat | cmd /Q</pre>
</div>
</div>
<div class="paragraph">
<p>This will install <code>eldev.bat</code> script to <code>%USERPROFILE%\.local\bin</code>.</p>
</div>
</div>
</div>
</li>
<li>
<p>Add this directory to your <code>PATH</code>:</p>
<div class="literalblock">
<div class="content">
<pre>&gt; reg add HKCU\Environment /v Path /d "%USERPROFILE%\.local\bin;%PATH%" /f</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Afterwards Eldev will bootstrap itself as needed on first invocation.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>eldev</code> doesn’t <em>really</em> need to be findable through <code>PATH</code> — it
will work regardless.  This is rather for your convenience, so that
you don’t need to type the full path again and again.
</td>
</tr>
</table>
</div>
<h4 id="_installing_from_sources" class="discrete">Installing from sources</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clone the source tree from GitHub.</p>
</li>
<li>
<p>In the cloned working directory execute,</p>
<div class="ulist">
<ul>
<li>
<p>on Linux, macOS, etc.:</p>
<div class="literalblock">
<div class="content">
<pre>$ ./install.sh DIRECTORY</pre>
</div>
</div>
</li>
<li>
<p>on Windows:</p>
<div class="literalblock">
<div class="content">
<pre>&gt; install.bat DIRECTORY</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Here <code>DIRECTORY</code> is the location of <code>eldev</code> executable should be put.
It should be in <code>PATH</code> environment variable, or else you will need to
specify full path each time you invoke Eldev.  You probably have
sth. like <code>~/bin</code> in your <code>PATH</code> already, which would be a good value
for <code>DIRECTORY</code>.  You could even install in e.g. <code>/usr/local/bin</code> —
but make sure you have permissions first.</p>
</div>
<h4 id="_mostly_for_developing_eldev_itself" class="discrete">Mostly for developing Eldev itself</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clone the source tree from GitHub.</p>
</li>
<li>
<p>Set environment variable <code>ELDEV_LOCAL</code> to the full path of the
working directory.</p>
</li>
<li>
<p>Make sure executable <code>eldev</code> is available.  Either follow any of the
first way to install Eldev, or symlink/copy file <code>bin/eldev</code> from
the cloned directory to somewhere on your <code>PATH</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now each time Eldev is executed, it will use the sources at
<code>ELDEV_LOCAL</code>.  You can even modify it and see how that affects Eldev
immediately.</p>
</div>
<div class="sect2">
<h3 id="_upgrading_eldev">Upgrading Eldev</h3>
<div class="paragraph">
<p>Eldev bootstraps itself when needed, but won’t automatically fetch new
versions.  To upgrade it later, explicitly run (from any directory):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev upgrade-self</pre>
</div>
</div>
<div class="paragraph">
<p>By default it uses MELPA Stable.  If you want to test or use some not
yet officially released version, try:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev --unstable upgrade-self</pre>
</div>
</div>
<div class="paragraph">
<p>This will make it use MELPA Unstable for upgrading.  If you want to
switch back to the latest stable version (as recommended), supply <code>-d</code>
(<code>--downgrade</code>) option to the command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev upgrade-self -d</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_safety_concerns">Safety concerns</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In general, it is not recommended to execute Eldev, GNU Make,
Scons, any other build tool or anything based on one in a directory
that contains untrusted code.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Like many (if not most) other development tools, Eldev is unsafe when
executed on untrusted code.  For example, simply running <code>eldev</code> in a
project you have just downloaded from <code>hackerden.org</code> can result in
anything, including emptied home directory.  For that matter, running
<code>make</code> or <code>gradle</code> is not better in this regard.  Eldev is perhaps <em>a
bit</em> more dangerous, because even <code>eldev help</code> reads file <code>Eldev</code>,
thus executing arbitrary code.</p>
</div>
<div class="paragraph">
<p>Even seemingly harmless things, like opening a <code>.el</code> file in Emacs can
lead to unforeseen consequences.  If you e.g. have
<a href="https://www.flycheck.org/">Flycheck</a> enabled everywhere, this will result in
byte-compiling said file, which also can execute arbitrary code, for
example using <code>(eval-when-compile &#8230;&#8203;)</code> form.  The same holds for
installing (not even using!) Elisp packages.</p>
</div>
<div class="paragraph">
<p>Only use build tools on code that you trust.  Better yet, don’t even
touch code that you don’t plan running.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">Getting started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Eldev comes with built-in help.  Just run:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev help</pre>
</div>
</div>
<div class="paragraph">
<p>This will list all the commands Eldev supports.  To see detailed
description of any of those, type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev help COMMAND</pre>
</div>
</div>
<div class="paragraph">
<p>In the help you can also see lots of options — both global and
specific to certain commands.  Many common things are possible just
out of the box, but <a href="#extending-eldev">later we will discuss</a> how to
define additional commands and options or change defaults for the
existing.</p>
</div>
<div class="paragraph">
<p>Two most important global options to remember are <code>--trace</code> (<code>-t</code>) and
<code>--debug</code> (<code>-d</code>).  With the first one, Eldev prints lots of additional
information about what it is doing to stdout.  With the second, Eldev
prints stacktraces for most errors.  These options will often help you
figure out what’s going wrong without requesting any external
assistance.  Also check out section on <a href="#debugging-features">various
debugging features</a> discussed later.</p>
</div>
<div class="paragraph">
<p>Eldev mostly follows GNU conventions in its command line.  Perhaps the
only exception is that global options must be specified before command
name and command-specific options — after it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_initializing_a_project">Initializing a project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When Eldev starts up, it configures itself for the project in the
directory where it is run from.  This is done by loading Elisp file
called <code>Eldev</code> (without extension!) in the current directory.  This
file is similar to Make’s <code>Makefile</code> or Cask’s <code>Cask</code>.  But even more
so to Gradle’s <code>build.gradle</code>: because it is a program.  File <code>Eldev</code>
is not strictly required, but nearly all projects will have one.  It
is also generally recommended to create it even if empty, because
otherwise some tools (e.g. <a href="https://github.com/flycheck/flycheck-eldev">flycheck-eldev</a>,
<a href="https://github.com/bbatsov/projectile">Projectile</a>) will not recognize the project as
Eldev-based without it.</p>
</div>
<div class="paragraph">
<p>You can create the file in your project manually, but it is easier to
just let Eldev itself do it for you, especially the first time:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev init</pre>
</div>
</div>
<div class="paragraph">
<p>If you let the initializer do its work, it will create file <code>Eldev</code>
already prepared to download project dependencies.  If you answer “no”
to its question (or execute as <code>eldev init --non-interactive</code>), just
edit the created file and uncomment some of the calls to
<code>eldev-use-package-archive</code> there as appropriate.  These forms
instruct Eldev to use specific package archives to download project
dependencies.</p>
</div>
<div class="paragraph">
<p>After this step, Eldev is ready to work with your project.</p>
</div>
<div class="sect2">
<h3 id="githooks">Initializing a checkout</h3>
<div class="paragraph">
<p>If your project uses <a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks#_git_hooks">Git hooks</a>, you can take
advantage of Eldev’s command <code>githooks</code> to install them:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev githooks
Installed as symbolic link: ‘.git/hooks/pre-commit’ -&gt; ‘githooks/pre-commit’</pre>
</div>
</div>
<div class="paragraph">
<p>Eldev doesn’t try to enforce any hooks on you, instead, it only
symlinks the files the project has in directory <code>githooks</code> to the
place Git expects them.  For security reasons, Git doesn’t activate
any hooks by default upon repository cloning, this has to be an
explicit decision — be that copying by hands or an Eldev invocation.</p>
</div>
<div class="paragraph">
<p>If you don’t have such a subdirectory, command will not do anything
and will also not be shown in the output of <code>eldev help</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setup-procedure">Setup procedure in details</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we have created file <code>Eldev</code>, it makes sense to go over the
full startup process:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Load file <code>~/.config/eldev/config</code></p>
</li>
<li>
<p>Load file <code>Eldev</code> in the current directory</p>
</li>
<li>
<p>Load file <code>Eldev-local</code> in the current directory</p>
</li>
<li>
<p>Execute setup forms specified on the command line</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>None of these Elisp files and forms are required.  They are also not
restricted in what they do.  However, their <em>intended</em> usage is
different.</p>
</div>
<div class="paragraph">
<p>File <code>~/.config/eldev/config</code> is <em>user-specific</em>.  It is meant mostly
for customizing Eldev to your personal preferences.  For example, if
you hate coloring of Eldev output, add form <code>(setf eldev-coloring-mode
nil)</code> to it.  Then every Eldev process started for any project will
default to using uncolored output.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<span class="image right"><img src="https://img.shields.io/badge/since-0.11-8be" alt="Since 0.11"></span> More precisely, if directory <code>~/.eldev</code> exists (for
pre-0.11 Eldev installations), file <code>~/.eldev/config</code> is used.
Otherwise, if <a href="https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html">environment variable <code>XDG_CONFIG_HOME</code></a> is
set, file <code>$XDG_CONFIG_HOME/eldev/config</code> is used.  And finally,
<code>~/.config/eldev/config</code> is the default fallback.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>File <code>Eldev</code> is <em>project-specific</em>.  It is the only configuration file
that should be added to project’s VCS (Git, Mercurial, etc.).  Typical
usage of this file is to define in which package archives to look up
dependencies.  It is also the place to define project-specific
builders and commands, for example to build project documentation from
source.</p>
</div>
<div class="paragraph">
<p>File <code>Eldev-local</code> is <em>working directory</em> or <em>user/project-specific</em>.
Unlike <code>Eldev</code>, it <em>should not</em> be added to VCS: it is meant to be
created by each developer (should he want to do so) to customize how
Eldev behaves in this specific directory.  The most common use is to
define local dependencies.  A good practice is to instruct your VSC to
ignore this file, e.g. list it in <code>.gitignore</code> for Git.</p>
</div>
<div class="paragraph">
<p>Finally, it is possible to specify some (short) setup forms on the
command line using <code>--setup</code> (<code>-S</code>) option.  This is not supposed to
be used often, mostly in cases where you run Eldev on a use-once
project checkout, e.g. on a <a href="#continuous-integration">continuous
integration</a> server.</p>
</div>
<div class="sect2">
<h3 id="project-isolation">Project isolation</h3>
<div class="paragraph">
<p>Eldev tries to create a self-contained environment for building and
testing your project.  It will isolate your project as much as
possible from your “normal” Emacs, i.e. the one that you use for
editing.  This is done to avoid interference from your other installed
packages or configuration, to prevent broken and misbehaving projects
from affecting your Emacs and, finally, to simplify testing of certain
“permanent effect” features, like customizing variables.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Packages installed in your Emacs (usually in <code>~/.emacs.d/elpa/</code>) are
not visible for projects built with Eldev.  Likewise, dependencies
installed for such projects will not appear in your normal Emacs.</p>
</li>
<li>
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.2.1-8be" alt="Since 0.2.1"></span> Variable <code>user-emacs-directory</code> will point somewhere
inside <code>.eldev</code> in the project’s directory rather than to
<code>~/.emacs.d</code>.  This also means that <code>locate-user-emacs-file</code> will
not find files in your normal configuration directory.  If you want
to undo this change (e.g. in file <code>Eldev</code> or <code>Eldev-local</code>), use
original value of the variable stored as
<code>eldev-real-user-emacs-directory</code>.</p>
</li>
<li>
<p>Eldev supports <a href="#different-emacs-versions">executing on different
Emacs version</a> for the same project without any additional steps.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_using_preinstalled_dependencies">Using preinstalled dependencies</h3>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.8-8be" alt="Since 0.8"></span> Starting with version 0.8 you can opt out of some of the
default project isolation features and use preinstalled dependencies,
e.g. those from your normal Emacs.  To activate this mode, use global
option <code>--external</code> (<code>-X</code>), e.g.:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev -X test</pre>
</div>
</div>
<div class="paragraph">
<p>In this mode Eldev will expect dependencies to be installed in given
directory (standard Emacs location — <code>~/.emacs.d/elpa</code> — is only the
default: you can use another directory).  If a dependency is not
installed, Eldev <em>will not</em> install it on its own: it doesn’t know
which package archives should be used.  Likewise, it will not upgrade
anything.  In all such cases, i.e. when required dependencies are not
correctly preinstalled in the specified external directory, Eldev will
simply fail.</p>
</div>
<div class="paragraph">
<p><a href="#local-dependencies">Local dependencies</a> discussed later take
precedence even in this mode: anything declared as local will override
dependencies available from an external directory, just like it will
in usual full isolation mode.</p>
</div>
<div class="paragraph">
<p>This mode can be useful to load exactly the same dependency versions
as those installed in your normal Emacs.  However, it is not suitable
for continuous integration or for working on packages that you do not
have — for whatever reason — installed normally.  It is also difficult
to test on <a href="#different-emacs-versions">different Emacs versions</a> in
external directory mode.  Therefore, it is not the default.  But, as
usual in Eldev, you can make it the default in file
<code>~/.config/eldev/config</code> if you want.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dependencies">Project dependencies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Eldev picks up project dependencies from package declaration,
i.e. usually from <code>Package-Requires</code> header in the project’s main
<code>.el</code> file.  If you have several files with package headers in the the
root directory, you need to set variable <code>eldev-project-main-file</code>,
else function <code>package-dir-info</code> can pick a wrong one.  In any case,
you don’t need to declare these dependencies second time in <code>Eldev</code>
and keep track that they remain in sync.</p>
</div>
<div class="paragraph">
<p>However, you do need to tell Eldev how to <em>find</em> these dependencies.
Like Cask, by default it doesn’t use any package archives.  To tell it
to use an archive, call function <code>eldev-use-package-archive</code> in
<code>Eldev</code> (you have such forms already in place if you have used <code>eldev
init</code>).  For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(eldev-use-package-archive 'melpa)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Eldev knows about three “standard” archives, which should cover most
of your needs: <code>gnu-elpa</code>, <code>nongnu-elpa</code> and <code>melpa</code>.</p>
</div>
<div class="paragraph">
<p>You can also explicitly choose stable (a.k.a. release: <code>gnu</code>, <code>nongnu</code>
and <code>melpa-stable</code>) or unstable (a.k.a. snapshot or development:
<code>gnu-devel</code>, <code>nongnu-devel</code> and <code>melpa-unstable</code>) variants instead.
There are some naming inconsistencies here, because for GNU and NonGNU
only the stable variants had been added at first (<code>nongnu</code> only in
0.10), nonstable (development) were added later, in 1.1.</p>
</div>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.5-8be" alt="Since 0.5"></span> A better way is provided by two global options: <code>--stable</code>
(the default) and <code>--unstable</code>.  Normally, Eldev will try to install
everything from stable archive variants (you wouldn’t want your tests
fail only because a dependency in an unstable version has a bug).
However, if a package is not available (at all or in the required
version) from the stable archive, unstable will be used automatically.
If you specify <code>--unstable</code> on the command line, Eldev will behave in
the opposite way: prefer the unstable archive and use the stable only
as a fallback.</p>
</div>
<div class="paragraph">
<p>Emacs 25 and up supports package archive priorities.  Eldev backports
this to Emacs 24 and utilizes the feature to assign the standard
archives it knows about priorities 300/190 (GNU ELPA, stable/unstable
variants), 250/150 (NonGNU ELPA), and 200/100 (MELPA).  A dependency
from a package with a lower priority is installed only if there are no
other options.</p>
</div>
<div class="paragraph">
<p>If dependencies for your project are only available from some other
archive, you can still use the same function.  Just substite the
symbolic archive name with a cons cell of name and URL as strings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(eldev-use-package-archive '("myarchive" . "http://my.archive.com/packages/"))</code></pre>
</div>
</div>
<div class="paragraph">
<p>You don’t need to perform any additional steps to have Eldev actually
install the dependencies: any command that needs them will make sure
they are installed first.  However, if you want to check if package
archives have been specified correctly and all dependencies can be
looked up without problems, you can explicitly use command <code>prepare</code>.</p>
</div>
<div class="sect2">
<h3 id="local-dependencies">Local dependencies</h3>
<div class="paragraph">
<p>Imagine you are developing more than one project at once and they
depend on each other.  You’d typically want to test the changes you
make in one of them from another right away.  If you are familiar with
Cask, this is solved by linking projects in it.</p>
</div>
<div class="paragraph">
<p>Eldev provides a more flexible approach to this problem called <em>local
dependencies</em>.  Let’s assume you develop project <code>foo</code> in directory
<code>~/foo</code> and also a library called <code>barlib</code> in <code>~/barlib</code>.  And <code>foo</code>
uses the library.  To have Eldev use your local copy of <code>barlib</code>
instead of downloading it e.g. from MELPA, add the following form in
file <code>~/foo/Eldev-local</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(eldev-use-local-dependency "~/barlib")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the form <em>must not</em> be added to <code>Eldev</code>: other developers
who check out your project probably don’t even have a local copy of
<code>barlib</code> or maybe have it in some other place.  In other words, this
should really remain your own private setting and go to <code>Eldev-local</code>.</p>
</div>
<div class="paragraph">
<p>Local dependencies have <em>loading modes</em>, just as the project’s package
itself.  Those will be discussed <a href="#loading-modes">later</a>.</p>
</div>
<div class="paragraph">
<p>Eldev correctly handles situations with changing definitions of local
dependencies.  I.e. by simply commenting out or uncommenting
<code>eldev-use-local-dependency</code> call, you can quickly test your project
both with a MELPA-provided package and with a local dependency — Eldev
will adapt without any additional work from you.</p>
</div>
</div>
<div class="sect2">
<h3 id="additional-dependencies">Additional dependencies</h3>
<div class="paragraph">
<p>It is possible to register additional dependencies for use only by
certain Eldev commands.  Perhaps the most useful is to make certain
packages available for testing purposes.  For example, if your project
doesn’t depend on package <code>foo</code> on its own, but your test files do,
add the following form to <code>Eldev</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(eldev-add-extra-dependencies 'test 'foo)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additional dependencies are looked up in the same way as normal ones.
So, you need to make sure that all of them are available from the
package archives you instructed Eldev to use.</p>
</div>
<div class="paragraph">
<p>The following commands make use of additional dependencies: <code>build</code>,
<code>emacs</code>, <code>eval</code>, <code>exec</code> and <code>test</code>.  Commands you define yourself can
also take advantage of this mechanism, see function
<code>eldev-load-project-dependencies</code>.</p>
</div>
<div class="sect3">
<h4 id="extended-dependency-format">Extended dependency format</h4>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.2-8be" alt="Since 0.2"></span> Normally to specify an additional dependency you just need
to provide its package name as a symbol.  However, Eldev also supports
“extended” format, that lets you specify other details.  In this
format, dependency is specified as a property list (plist):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(:package  DEPENDENCY-NAME
 :version  REQUIRED-VERSION
 :archive  PACKAGE-ARCHIVE
 :archives (PACKAGE-ARCHIVE...)
 :optional OPTIONAL)</code></pre>
</div>
</div>
<div class="paragraph">
<p>All keywords except <code>:package</code> can be omitted.  In the extended format
you can specify which version of the dependency is required (normally,
any version will do) and which package archive(s) to use (by default,
the same archives as for normal dependencies are used).  In values
associated with <code>:archive</code>/<code>:archives</code> standard shortcuts <code>gnu</code> (for
GNU ELPA) and <code>melpa</code> (for MELPA; also <code>melpa-stable</code> and
<code>melpa-unstable</code>) can be used.  Dependencies can also be marked as
optional, see the next subsection.</p>
</div>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.9-8be" alt="Since 0.9"></span> There is also a special format for referring to certain
tools like <a href="#buttercup">Buttercup</a>: <code>(:tool TOOL-NAME)</code>.  For details,
refer to section <a href="#development-tool-sources">Development tool
sources</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_optional_additional_dependencies">Optional additional dependencies</h4>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.9-8be" alt="Since 0.9"></span> Suppose you want to test your project’s integration with a
third-party package, but don’t strictly <em>need</em> it.  And, additionally,
relevant tests are written in such a way as to simply be skipped if
said package is not available, e.g. using <code>ert-skip</code> or
<code>buttercup-skip</code>.  In this case you may want to declare the package as
an <em>optional additional dependency</em>, so that you don&#8217;t need to care if
it can be installed during continuous integration or not:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(eldev-add-extra-dependencies 'test '(:package helm :optional t))</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we declare that we want Helm for testing, but don&#8217;t
care much if it cannot be installed, e.g. because of too old Emacs
version.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examining_dependencies">Examining dependencies</h3>
<div class="paragraph">
<p>Sometimes it is useful to check what a project depends on, especially
if it is not your project, just something you have checked out.  There
are two commands for this in Eldev.</p>
</div>
<div class="paragraph">
<p>First is <code>dependencies</code> (can be shortened to <code>deps</code>).  It lists
<em>direct</em> dependencies of the project being built.  By default, it
omits any built-in packages, most importantly <code>emacs</code>.  If you want to
check those too, add option <code>-b</code> (<code>--list-built-ins</code>).</p>
</div>
<div class="paragraph">
<p>Second is <code>dependecy-tree</code> (short alias: <code>dtree</code>).  It prints a tree
of project direct dependencies, direct dependencies of those, and so
on — recursively.  Like with the first command, use option <code>-b</code> if you
want to see built-ins in the tree.</p>
</div>
<div class="paragraph">
<p>Both commands can also list additional dependencies if instructed:
just specify set name(s) on the command line, e.g.:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev dependencies test</pre>
</div>
</div>
<div class="paragraph">
<p>You can also check which archives Eldev uses to look up dependencies
for this particular project with the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev archives</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_upgrading_dependencies">Upgrading dependencies</h3>
<div class="paragraph">
<p>Eldev will install project dependencies automatically, but it will
never upgrade them, at least if you don’t change your project to
require a newer version.  However, you can always explicitly ask Eldev
to upgrade the installed dependencies:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev upgrade</pre>
</div>
</div>
<div class="paragraph">
<p>First, package archive contents will be refetched, so that Eldev knows
about newly available versions.  Next, this command upgrades (or
installs, if necessary) all project dependencies and all additional
dependencies you might have registered (see
<a href="#additional-dependencies">above</a>).  If you don’t want to upgrade
everything, you can explicitly list names of the packages that should
be upgraded:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev upgrade dash ht</pre>
</div>
</div>
<div class="paragraph">
<p>You can also check what Eldev would upgrade without actually upgrading
anything:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev upgrade --dry-run</pre>
</div>
</div>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.5-8be" alt="Since 0.5"></span> If you use MELPA for looking up dependencies, you can
switch between Stable and Unstable using global options with the same
name, i.e.:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev --unstable upgrade</pre>
</div>
</div>
<div class="paragraph">
<p>Because of the incompatible version numbers that MELPA Unstable
supplies, you cannot directly “upgrade” from an unstable version back
to a stable one.  But you can specify option <code>-d</code> (<code>--downgrade</code>) to
the command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev --stable upgrade -d</pre>
</div>
</div>
<div class="paragraph">
<p>In this case Eldev will downgrade dependencies if this allows it to
use more preferable package archive.  (Since <code>--stable</code> is the
default, specifying it in the command above is not really needed, it’s
only mentioned for clarity.)</p>
</div>
<div class="paragraph">
<p>To install unstable version of only a specific dependency, while
leaving all others at stable versions, combine <code>--unstable</code> with
listing package names after the command, e.g.:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev --unstable upgrade dash</pre>
</div>
</div>
<div class="sect3">
<h4 id="_upgrading_development_tools">Upgrading development tools</h4>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.6-8be" alt="Since 0.6"></span> Command <code>upgrade</code> works not only with package
dependencies, but also with common development tools used by the
project during development, for example <a href="#buttercup">Buttercup</a> or
<a href="#linting">various linters</a>.  This works exactly the same as for
project dependencies, with the only exception that the tool must be
installed first.  E.g., for Buttercup you need to <a href="#testing">test</a>
your project at least once, so that Eldev knows about the need for
this tool.</p>
</div>
<div class="paragraph">
<p>Development tools are installed from package archives hardcoded inside
Eldev (but see <a href="#development-tool-sources">the next section</a>),
regardless of which archives you have configured for your project.
For example, even if you use <code>melpa-unstable</code> archive, Buttercup will
still be installed from MELPA Stable (unless, of course, you use
<code>--unstable</code> global option).  If you need, you can switch to unstable
version of the tool later:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev --unstable upgrade buttercup</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="development-tool-sources">Development tool sources</h3>
<div class="paragraph">
<p>Eldev knows how to install certain development tools and also uses
predefined package archives for this, not the ones you specify in
project’s configuration.  This means you don’t need to list archives
for tools like <a href="#buttercup">Buttercup</a>: only list them if they are
needed to look up real dependencies.</p>
</div>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.9-8be" alt="Since 0.9"></span> There is a simple way to customize where exactly Eldev
finds the tools: use variable <code>eldev-known-tool-packages</code> for this.
The value of the variable is an alist keyed by tool names and
containing <a href="#extended-dependency-format">package descriptor plists</a> as
values.  By default it already contains information about the tools
Eldev knows about.  You can add more or replace existing ones if you
need: just <code>push</code> more entries at the beginning of the list, there is
no need to actually remove anything.</p>
</div>
<div class="paragraph">
<p>You can also use the tools as e.g. runtime dependencies if needed
(though in most cases you should leave this to Eldev).  Just specify
package plist as <code>(:tool TOOL-NAME)</code> for this.  Both tools with
built-in support and any new you add to <code>eldev-known-tool-packages</code>
can be referred this way.</p>
</div>
<div class="paragraph">
<p>Current list of the known tools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>buttercup</code></p>
</li>
<li>
<p><code>ecukes</code></p>
</li>
<li>
<p><code>package-lint</code></p>
</li>
<li>
<p><code>relint</code></p>
</li>
<li>
<p><code>elisp-lint</code></p>
</li>
<li>
<p><code>undercover</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="global-cache">Global package archive cache</h3>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.4-8be" alt="Since 0.4"></span> To avoid downloading the same packages repeatedly, Eldev
employs a package archive cache.  This cache is shared between all
projects and <a href="#different-emacs-versions">all Emacs versions</a> on your
machine.  It can significantly speed up package preparation if you use
a new project, test it on another Emacs version or delete
project-specific cache (subdirectory <code>.eldev</code>) for whatever reason.</p>
</div>
<div class="paragraph">
<p>By default, downloaded packages stay cached indefinitely, while
archive contents expires in one hour.  However, if you use command
<code>upgrade</code> or <code>upgrade-self</code>, package archive contents is always
refreshed.</p>
</div>
<div class="paragraph">
<p>Cache usage is not controllable from command line.  However, you can
customize it somewhat in <code>~/.config/eldev/config</code>.  Variable
<code>eldev-enable-global-package-archive-cache</code> lets you disable the
global cache outright.  Using
<code>eldev-global-cache-archive-contents-max-age</code> you can adjust how long
cached copies of <code>archive-contents</code> stay valid.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="loading-modes">Loading modes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Eldev the project’s package and its local dependencies have
<em>loading modes</em>.  This affects exactly how the package (that of the
project or of its local dependency) becomes loadable by Emacs.</p>
</div>
<div class="paragraph">
<p>Default loading mode is called <code>as-is</code>.  It means the directory where
project (or local dependency) is located is simply added to Emacs
varible <code>load-path</code> and normal Emacs loading should be able to find
required features from there on.  This is the fastest mode, since it
requires no preparation and in most cases is basically what you want
during development.</p>
</div>
<div class="paragraph">
<p>However, users won’t have your project loaded like that.  To emulate
the way that most of the people will use it, you can use loading mode
<code>packaged</code>.  In this mode, Eldev will first build a package out of
your project (or local dependency), then install and activate it using
Emacs’ packaging system.  This is quite a bit slower than <code>as-is</code>,
because it involves several preparation steps.  However, this is
almost exactly the way normal users will use your project after
e.g. installing it from MELPA.  For this reason, this mode is
recommended for <a href="#continuous-integration">continuous integration</a> and
other forms of automated testing.</p>
</div>
<div class="paragraph">
<p>Other modes include <code>byte-compiled</code> and <code>source</code>.  In these modes
loading is performed just as in <code>as-is</code> mode, but before that Eldev
either byte-compiles everything or, vice-versa, removes <code>.elc</code> files.</p>
</div>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-1.4-8be" alt="Since 1.4"></span> Loading mode <code>compiled-on-demand</code> is useful primarily to
larger projects that include some computation-intensive code which
needs to be byte-compiled to run in reasonable time.  In this mode,
only when a project file is loaded, e.g. via <code>require</code> form, it is
byte-compiled if needed.  In contrast, in mode <code>byte-compiled</code> <em>all</em>
Elisp files are byte-compiled before a command (e.g. <code>test</code>) even gets
to start working.  This makes the mode useful during work on the
project “core” because 1) compilation time is reduced; 2) you can test
or otherwise use the core without even updating higher-level files to
be compilable first.  However, as a drawback, compilation can run “in
the middle” of project’s real code, which can occasionally cause
unforeseen troubles, as well as screw up <a href="#profiling">profiling</a>.</p>
</div>
<div class="paragraph">
<p>When using <a href="#evaluating">commands <code>exec</code> and <code>eval</code></a> with
<code>compiled-on-demand</code> mode, you may want to use option <code>-R</code>
(<code>--dont-require</code>) and then manually <code>require</code> only the necessary
features, to reduce the set of files that have to be (re)compiled.</p>
</div>
<div class="paragraph">
<p>So, after discussing various loading modes, let’s have a look at how
exactly you tell Eldev which one to use.</p>
</div>
<div class="paragraph">
<p>For the project itself, this is done from the command line using
global option <code>--loading</code> (or <code>-m</code>) with its argument being the name
of the mode.  Since this is supposed to be used quite frequently,
there are also shortcut options to select specific modes: <code>--as-is</code>
(or <code>-a</code>), <code>--packaged</code> (<code>-p</code>), <code>--source</code> (<code>-s</code>), <code>--byte-compiled</code>
(<code>-c</code>) and <code>--compiled-on-demand</code> (<code>-o</code>).  For example, the following
command will run unit-tests in the project, having it loaded as an
Emacs package:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev -p test</pre>
</div>
</div>
<div class="paragraph">
<p>Remember, that as everything in Eldev, this can be customized.
E.g. if you want to run your project byte-compiled by default, add
this to your <code>Eldev-local</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(setf eldev-project-loading-mode 'byte-compiled)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For local dependencies the mode can be chosen when calling
<code>eldev-use-local-dependency</code>.  For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(eldev-use-local-dependency "~/barlib" 'packaged)</code></pre>
</div>
</div>
<div class="paragraph">
<p>As mentioned above, loading mode defaults to <code>as-is</code>.</p>
</div>
<div class="paragraph">
<p>There are a few other loading modes useful only for certain projects.
You can always ask Eldev for a full list:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev --list-modes</pre>
</div>
</div>
<div class="sect2">
<h3 id="autoloads">Autoloads</h3>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.6-8be" alt="Since 0.6"></span> Autoloaded functions of installed Elisp packages can be
accessed without a <code>require</code> form.  To simplify development, Eldev
provides the same functionality for projects regardless of loading
mode, as long as file <code>PACKAGE-autoloads.el</code> exists.  This might look
like an unwieldy requirement, but luckily there is
<a href="#autoloads-plugin">a plugin</a> for building the file and keeping it
up-to-date as necessary.  The reason this is not enabled by default is
that many projects — especially those not providing user-visible
functionality, or those that consist of a single file — don’t have any
autoloading functions or other forms.</p>
</div>
<div class="paragraph">
<p>Local dependencies also have their autoloads activated regardless of
loading mode.  If the autoloads file is kept up-to-date using
<a href="#autoloads-plugin">the plugin</a>, Eldev will take care to do this as
needed in local dependencies too.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build-system">Build system</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Eldev comes with quite a sofisticated build system.  While by default
it only knows how to build packages, byte-compile <code>.el</code> files and make
<code>.info</code> from <code>.texi</code>, you can extend it with custom <em>builders</em> that
can do anything you want.  For example, generate resource files that
should be included in the final package.</p>
</div>
<div class="paragraph">
<p>The main command is predictably called <code>build</code>.  There are also
several related commands which will be discussed in the next sections.</p>
</div>
<div class="sect2">
<h3 id="_targets">Targets</h3>
<div class="paragraph">
<p>Build system is based on <em>targets</em>.  Targets come in two kinds: <em>real</em>
and <em>virtual</em>.  First type of targets corresponds to files — not
necessarily already existing.  When needed, such targets get rebuilt
and the files are (re)generated in process.  Targets of the second
type always have names that begin with “:” (like keywords in Elisp).
Most import virtual target is called <code>:default</code> — this is what Eldev
will build if you don’t request anything explicitly.</p>
</div>
<div class="paragraph">
<p>To find all targets in a project (more precisely, its <code>main</code>
<a href="#target-sets">target set</a>):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev targets</pre>
</div>
</div>
<div class="paragraph">
<p>Project’s targets form a tree.  Before a higher-level target can be
built, all its children must be up-to-date, i.e. built first if
necessary.  In the tree you can also see <em>sources</em> for some targets.
Those can be distinguished by lack of builder name in brackets.
Additionally, if output is colored, targets have special color, while
sources use default text color.</p>
</div>
<div class="paragraph">
<p>Here is how target tree looks for Eldev project itself (version may be
different and more targets may be added in future):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>:default
    bin/eldev  [SUBST]
        bin/eldev.in
:package
    dist/eldev-0.1.tar  [PACK]
        bin/eldev  [repeated, see above]
        eldev-ert.el
        eldev-util.el
        eldev.el
:compile
    eldev-ert.elc  [ELC]
        eldev-ert.el
    eldev-util.elc  [ELC]
        eldev-util.el
    eldev.elc  [ELC]
        eldev.el
:package-archive-entry
    dist/eldev-0.1.entry  [repeated, see ‘dist/eldev-0.1.tar’ above]</pre>
</div>
</div>
<div class="paragraph">
<p>And a short explanation of various elements:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>:default</code>, <code>:package</code>, <code>:compile</code> etc.</dt>
<dd>
<p>Virtual targets.  The ones you see above are typical, but there
could be more.</p>
</dd>
<dt class="hdlist1"><code>bin/eldev</code>, <code>dist/eldev-0.1.tar</code>, <code>eldev-ert.elc</code> etc.</dt>
<dd>
<p>Real targets.</p>
</dd>
<dt class="hdlist1"><code>SUBST</code>, <code>PACK</code>, <code>ELC</code></dt>
<dd>
<p>Builders used to generate target.  Note that virtual targets never
have builders.  <code>SUBST</code> is not a standard builder, it is defined
in file <code>Eldev</code> of the project.</p>
</dd>
<dt class="hdlist1"><code>bin/eldev.in</code>, <code>eldev-ert.el</code> etc.</dt>
<dd>
<p>Sources for generating targets.  Certain targets have more than
one source file.  Also note how targets can have other targets as
their sources (<code>bin/eldev</code> is both a target on its own and a
source for <code>dist/eldev-0.1.tar</code>).</p>
</dd>
<dt class="hdlist1"><code>[repeated ...]</code></dt>
<dd>
<p>To avoid exponential increase in tree size, Eldev doesn’t repeat
target subtrees.  Instead, only root target of a subtree is
printed.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_target_cross_dependencies">Target cross-dependencies</h4>
<div class="paragraph">
<p>FIXME</p>
</div>
</div>
<div class="sect3">
<h4 id="target-sets">Target sets</h4>
<div class="paragraph">
<p>Eldev groups all targets into <em>sets</em>.  Normally, there are only two
sets called <code>main</code> and <code>test</code>, but you can define more if you need
(see variable <code>eldev-filesets</code>).  For example, if your project
includes a development tool that certainly shouldn’t be included in
project’s package, it makes sense to break it out into a separate
target set.</p>
</div>
<div class="paragraph">
<p>Target sets should be seen only as ways of grouping targets together
for the purpose of quickly enumerating them.  Two targets in the same
set can be completely independent from each other.  Similarly, targets
from different sets can depend on each other (provided this doesn’t
create a circular dependency, of course).  For example, targets in set
<code>test</code> will often depend on those in set <code>main</code>, because test <code>.el</code>
files usually <code>require</code> some features from <code>main</code>.</p>
</div>
<div class="paragraph">
<p>By default, command <code>build</code> operates only on <code>main</code> target set.  You
can use option <code>--set</code> (<code>-s</code>) to process a different target set.  If
you want to build several sets at once, repeat the option as many
times as needed.  Finally, you can use special name <code>all</code> to order
Eldev to operate on all defined sets at once.</p>
</div>
<div class="paragraph">
<p>Command <code>targets</code> instead of the option expects set names as its
arguments.  For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev targets test</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="packaging">Building packages</h3>
<div class="paragraph">
<p>To build an Elisp package out of your project, use command <code>package</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev package</pre>
</div>
</div>
<div class="paragraph">
<p>This command is basically a wrapper over the build system, it tells
the system to generate virtual target <code>:package</code>.  However, there are
a few options that can only be passed to this special command, not to
underlying <code>build</code>.</p>
</div>
<div class="paragraph">
<p>Files that are copied to the package <code>.tar</code> default to Elisp files
plus standard documentation: <code>*.info</code>, <code>doc/*.info</code> and files <code>dir</code>
along those.  However, if you need to package additional files, just
modify variable <code>eldev-files-to-package</code>.  Its value must be a
<a href="#filesets">fileset</a>.  In particular, you can extend the default
value, making a <a href="#composite-filesets">composite fileset</a>, instead of
replacing it.  Here is an example from Eldev’s own file <code>Eldev</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(setf eldev-files-to-package
      `(:or ,eldev-files-to-package
            '("./bin" "!./bin/**/*.in" "!./bin/**/*.part")))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we instruct package builder to copy all files from subdirectory
<code>bin</code>, except those with names ending in <code>.in</code> or <code>.part</code>,
additionally to the standard files.  If you distribute your package
through MELPA, you will unfortunately need to repeat these
instructions in MELPA recipe.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Previously, the recommended way was</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(setf eldev-files-to-package (append eldev-files-to-package ...))</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, this is wrong because it assumes that
<code>eldev-files-to-package</code> is a <a href="#simple-filesets">simple fileset</a> which
is no longer true since Eldev 1.2.  Replace this with code similar to
the new recommendation above; it works with any Eldev version.  See
also section <a href="#modifying-filesets">on modifying filesets</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Normally, packages are generated in subdirectory <code>dist</code> (more
precisely, in directory specified by <code>eldev-dist-dir</code> variable).  If
needed, you can override this using <code>--output-dir</code> option.</p>
</div>
<div class="paragraph">
<p>By default, Eldev will use package’s self-reported version, i.e. value
of “Version” header in its main <code>.el</code> file.  If you need to give the
package a different version, use option <code>--force-version</code>.  E.g. MELPA
would do this if it used Eldev.</p>
</div>
<div class="paragraph">
<p>Finally, if you are invoking Eldev from a different tool, you might be
interested in option <code>--print-filename</code>.  When it is specified, Eldev
will print absolute filename of the generated package and word
“generated” or “up-to-date” as the two last lines of its (stdout)
output.  Otherwise it is a bit tricky to find the package, especially
if you don’t use <code>--force-version</code> option.  As an optimisation, you
can also reuse previous package file if Eldev says “up-to-date”.</p>
</div>
</div>
<div class="sect2">
<h3 id="_byte_compiling">Byte-compiling</h3>
<div class="paragraph">
<p>You can use Eldev to byte-compile your project.  Indirectly, this can
be done by <a href="#loading-modes">selecting appropriate loading mode</a> for
the project or its local dependencies.  However, sometimes you might
want to do this explicitly.  For this, use command <code>compile</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev compile</pre>
</div>
</div>
<div class="paragraph">
<p>You can also byte-compile specific files:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev compile foo-util.el foo-misc.el</pre>
</div>
</div>
<div class="paragraph">
<p>Eldev will not recompile <code>.el</code> that have up-to-date <code>.elc</code> versions.
So, if you issue command <code>compile</code> twice in a row, it will say:
“Nothing to do” the second time.</p>
</div>
<div class="paragraph">
<p>However, simple comparison of modification time of <code>.el</code> and its
<code>.elc</code> file is not always enough.  Suppose file <code>foo-misc.el</code> has form
<code>(require 'foo-util)</code>.  If you edit <code>foo-util.el</code>, byte-compiled file
<code>foo-misc.elc</code> might no longer be correct, because it has been
compiled against old definitions from <code>foo-util.el</code>.  Luckily, Eldev
knows how to detect when a file <code>require</code>s another.  You can see
this in the target tree:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev targets --dependencies
[...]
:compile
    foo-misc.elc  [ELC]
        foo-misc.el
        [inh] foo-util.elc
[...]</pre>
</div>
</div>
<div class="paragraph">
<p>As a result, if you now edit <code>foo-util.el</code> and issue <code>compile</code> again,
both <code>foo-util.elc</code> and <code>foo-misc.elc</code> will be rebuilt.</p>
</div>
<div class="paragraph">
<p>Eldev treats warnings from Emacs’ byte-compiler just as that —
warnings, i.e. they will be shown, but will not prevent compilation
from generally succeeding.  However, during
<a href="#continuous-integration">automated testing</a> you might want to check
that there are no warnings.  The easiest way to do it is to use
<code>--warnings-as-errors</code> option (<code>-W</code>):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev compile --warnings-as-errors</pre>
</div>
</div>
<div class="paragraph">
<p>Command <code>compile</code> is actually only a wrapper over the generic building
system.  You can rewrite all the examples above using command <code>build</code>.
If you don’t specify files to compile, virtual target <code>:compile</code> is
built.  This target depends on all <code>.elc</code> files in the project.</p>
</div>
<div class="paragraph">
<p>However, there is a subtle difference: for <code>compile</code> you specify
<em>source</em> files, while <code>build</code> expects <em>targets</em>.  Therefore, example</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev compile foo-util.el foo-misc.el</pre>
</div>
</div>
<div class="paragraph">
<p>above is equivalent to this command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev build foo-util.elc foo-misc.elc</pre>
</div>
</div>
<div class="paragraph">
<p>with <code>.el</code> in filenames substituted with <code>.elc</code>.</p>
</div>
<div class="sect3">
<h4 id="_byte_compiling_complicated_macros">Byte-compiling complicated macros</h4>
<div class="paragraph">
<p>Certain files with macros in Elisp cannot be byte-compiled without
evaluating them first <em>or</em> carefully applying <code>eval-and-compile</code> to
functions used in macroexpansions.  Because Emacs packaging system
always loads (evaluates) package files before byte-compiling them
during installation, this is often overlooked.</p>
</div>
<div class="paragraph">
<p>Unlike the packaging system, Eldev by default expects that <code>.el</code> files
can be compiled <em>without</em> loading them first, i.e. it expects that
<code>eval-and-compile</code> is applied where needed.  This is the default
because it is much faster on certain files.</p>
</div>
<div class="paragraph">
<p>However, if your project cannot be byte-compiled without loading first
and you don’t want to “fix” this, you can ask Eldev to behave like the
packaging system using <code>--load-before-compiling</code> (<code>-l</code>) option:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev compile -l</pre>
</div>
</div>
<div class="paragraph">
<p>Projects that can only be compiled with this setting should specify it
as the default in their file <code>Eldev</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(setf eldev-build-load-before-byte-compiling t)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can find more information in section
<a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Eval-During-Compile.html">“Evaluation
During Compilation” of Elisp manual</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_speed_of_byte_compilation">Speed of byte-compilation</h4>
<div class="paragraph">
<p>While not particularly important in most cases, speed of
byte-compilation can become an issue in large projects, especially if
they use lots of macros.  Eldev tries to speed up byte-compilation by
compiling the files in “correct” order.</p>
</div>
<div class="paragraph">
<p>This means that if, as above, <code>foo-misc.el</code> <code>require</code>s feature
<code>foo-util</code>, then <code>foo-util.el</code> will always be byte-compiled first, so
that compilation of <code>foo-misc.el</code> can use faster, byte-compiled
versions of definitions from that file.  This works even if Eldev
doesn’t yet know which files <code>require</code> which.</p>
</div>
<div class="paragraph">
<p>When Eldev has to change the planned order of byte-compilation because
of a <code>require</code> form, it writes an appropriate message (you need to run
with option <code>-v</code> or <code>-t</code> to see it):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev -v compile
[...]
ELC      foo-misc.el
Byte-compiling file ‘foo-misc.el’...
ELC      foo-util.el
Byte-compiling file ‘foo-util.el’ early as ‘require’d from another file...
Done building “sources” for virtual target ‘:compile’</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cleaning">Cleaning</h3>
<div class="paragraph">
<p>While cleaning is not really part of the build system, it is closely
related.  Cleaning allows you to remove various generated files that
are the result of other commands (not only <code>build</code>).  Command can be
executed without any arguments:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev clean</pre>
</div>
</div>
<div class="paragraph">
<p>In this case, it removes byte-compiled Elisp files and any <code>.info</code>
files generated from <code>.texi</code>/<code>.texinfo</code> if you have those in your
project.</p>
</div>
<div class="paragraph">
<p>In general case, you can specify name one or more <em>cleaners</em> as
command arguments.  All supported cleaners can be found using option
<code>--list-cleaners</code> (<code>-L</code>).  Here is a short list of some of the more
useful ones:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>.eldev</code></dt>
<dd>
<p>Delete Eldev’s cache, i.e. subdirectory <code>.eldev</code> for this project.</p>
</dd>
<dt class="hdlist1"><code>distribution</code> (or <code>dist</code>)</dt>
<dd>
<p>Delete <code>dist</code> subdirectory; useful after <a href="#packaging">building
project’s package</a>.</p>
</dd>
<dt class="hdlist1"><code>test-results</code> (or <code>tests</code>)</dt>
<dd>
<p>Forget <a href="#test-results">previous test results</a>, for ERT.</p>
</dd>
<dt class="hdlist1"><code>global-cache</code></dt>
<dd>
<p>Remove contents of the <a href="#global-cache">global package archive
cache</a>.  This can be executed from any directory.</p>
</dd>
<dt class="hdlist1"><code>all</code> (or <code>everything</code>)</dt>
<dd>
<p>Run all available cleaners.  Some cross-project data may still be
retained (currently, only the global package archive cache), that
can be cleaned only by explicitly mentioning it.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Cleaners executed by default are called <code>.elc</code>, <code>.info</code> and
<code>info-dir</code>.  Normally, they delete their targets in all
<a href="#target-sets">target sets</a> at once.  However, you can limit them to
<code>main</code>, <code>test</code> and so on set with option <code>-s</code> (<code>--set</code>), e.g. command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev clean -s test</pre>
</div>
</div>
<div class="paragraph">
<p>would delete all byte-compiled test files.</p>
</div>
<div class="paragraph">
<p>You can also specify option <code>-n</code> (<code>--dry-run</code>) to see what would be
deleted, without actually deleting it.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing">Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Eldev has built-in support for running regression/unit tests of your
project.  Currently, Eldev supports <a href="https://www.gnu.org/software/emacs/manual/html_node/ert/index.html">ERT</a>,
<a href="https://github.com/jorgenschaefer/emacs-buttercup">Buttercup</a> and <a href="https://github.com/ecukes/ecukes">Ecukes</a> testing
frameworks.  Leave a feature request in the issue tracker if you are
interested in a different library.</p>
</div>
<div class="paragraph">
<p>Simply executing</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev test</pre>
</div>
</div>
<div class="paragraph">
<p>will run all your tests.  By default, all tests are expected to be in
files named <code>test.el</code>, <code>tests.el</code>, <code>*-test.el</code>, <code>*-tests.el</code> or in
<code>test</code> or <code>tests</code> subdirectories of the project root.  But you can
always change the value of <code>eldev-test-fileset</code> variable in the
project’s <code>Eldev</code> as appropriate.</p>
</div>
<div class="paragraph">
<p>By default, the command runs all available tests.  However, during
development you often need to run one or a few tests only — when you
hunt a specific bug, for example.  Eldev provides two ways to select
which tests to run.</p>
</div>
<div class="paragraph">
<p>First is by using a <em>selector</em> (<a href="#frameworks">framework-specific</a>,
this example is for <a href="#ert">ERT</a>):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev test foo-test-15</pre>
</div>
</div>
<div class="paragraph">
<p>will run only the test with that specific name.  It is of course
possible to select more than one test by specifying multiple
selectors: they are combined with ‘or’ operation.  You can use any
selector supported by the testing framework here, see its
documentation.</p>
</div>
<div class="paragraph">
<p>The second way is to avoid loading (and executing) certain test files
altogether.  This can be achieved with <code>--file</code> (<code>-f</code>) option:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev test -f foo.el</pre>
</div>
</div>
<div class="paragraph">
<p>will execute tests only in file <code>foo.el</code> and not in e.g. <code>bar.el</code>.
You don’t need to specify directory (e.g. <code>test/foo.el</code>); for reasons
why, see <a href="#filesets">explanation of Eldev filesets below</a>.</p>
</div>
<div class="paragraph">
<p>Both ways of selecting tests can be used together.  In this case they
are combined with ‘and’ operation: only tests that match selector and
which are defined in a loaded file are run.</p>
</div>
<div class="paragraph">
<p>When a test is failing, a backtrace of the failure is printed.  You
can affect its readability and completeness using options <code>-b</code>
(<code>--print-backtrace</code>, the default) and <code>-B</code> (<code>--omit-backtraces</code>).
The first option accepts your screen width as an optional parameter;
backtrace lines get cut to the specified width.  (Since 0.7 this can
also be specified as a global option that additionally affects all
other backtraces that are printed by Eldev.)  Special value of 0 (the
default in Eldev) disables truncation of backtrace lines.  Second
option, <code>-B</code>, is surprisingly useful.  In many cases backtraces don’t
actually give any useful information, especially when the tests
contain only a single assertion, and only clutter the output.  If you
have different preferences compared to Eldev, you can customize
variable <code>eldev-test-print-backtraces</code> in file
<code>~/.config/eldev/config</code>.</p>
</div>
<div class="paragraph">
<p>How exactly tests are executed depends on <em>test runner</em>.  If you
dislike the default behavior of Eldev, you can choose a different test
runner using <code>--runner</code> (<code>-r</code>) option of <code>test</code> command; see the list
of available test runners with their descriptions using
<code>--list-runners</code> option.  If you always use a different test runner,
it is a good idea to set it as the default in file
<code>~/.config/eldev/config</code>.  Finally, you can even write your own
runner.</p>
</div>
<div class="sect2">
<h3 id="frameworks">Frameworks</h3>
<div class="paragraph">
<p>As stated above, Eldev supports <a href="https://www.gnu.org/software/emacs/manual/html_node/ert/index.html">ERT</a> (Emacs built-in),
<a href="https://github.com/jorgenschaefer/emacs-buttercup">Buttercup</a> and <a href="https://github.com/ecukes/ecukes">Ecukes</a> testing
frameworks.  Normally, you don’t need to specify which framework the
project uses, as the tool can autodetect that.  But in rare cases you
may need to set variable <code>eldev-test-framework</code> to either <code>'ert</code>,
<code>'buttercup</code> or <code>'ecukes</code>, as appropriate.  It is also possible to use
more than one framework in a project, <a href="#multiple-frameworks">see
below</a>.  You don’t need to declare testing package(s) as
<a href="#additional-dependencies">extra dependencies</a>: Eldev will install
them itself when needed.</p>
</div>
<div class="paragraph">
<p>Eldev tries to provide uniform command line interface to the supported
frameworks, but of course there are many differences between them.</p>
</div>
<div class="sect3">
<h4 id="ert">ERT</h4>
<div class="paragraph">
<p><a href="https://www.gnu.org/software/emacs/manual/html_node/ert/index.html">ERT</a> is the “default” testing framework and also an Emacs
built-in.  This means that no additional packages need to be installed
and the framework is available on all non-ancient Emacs versions (at
least all Eldev itself supports).</p>
</div>
<div class="paragraph">
<p>All functionality of <code>test</code> command works with ERT.</p>
</div>
</div>
<div class="sect3">
<h4 id="buttercup">Buttercup</h4>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.2-8be" alt="Since 0.2"></span> <a href="https://github.com/jorgenschaefer/emacs-buttercup">Buttercup</a> is a behavior-driven
development framework for testing Emacs Lisp code.  Its support in
Eldev has some limitations.  On the other hand, certain functionality
is not supported by the library itself, and e.g. its <code>bin/buttercup</code>
script also doesn’t provide similar features.</p>
</div>
<div class="paragraph">
<p>When using Buttercup, selectors are <em>patterns</em> from
<a href="https://github.com/jorgenschaefer/emacs-buttercup/blob/master/docs/running-tests.md">the library’s documentation</a>.  I.e. they are
regular expressions in Emacs syntax, and only tests with names
matching at least one of the specified selectors/patterns are
executed.</p>
</div>
<div class="paragraph">
<p>Things that won’t work with Buttercup at the moment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>option <code>--stop-on-unexpected</code> (<code>-s</code>);</p>
</li>
<li>
<p>specifying screen width with option <code>--print-backtraces</code> (<code>-b</code>): it
will always work as if 80 was specified.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unlike <a href="#ert">ERT</a>, Buttercup also has no special selectors that base
on the previous run’s results.</p>
</div>
</div>
<div class="sect3">
<h4 id="ecukes">Ecukes</h4>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.10-8be" alt="Since 0.10"></span> <a href="https://github.com/ecukes/ecukes">Ecukes</a> is a framework for performing
integrational testing.  Its support in Eldev is limited to “script”
(a.k.a “batch”) mode: neither “no win” nor “win” mode is supported
currently.</p>
</div>
<div class="paragraph">
<p>Instead of adding more command-line options, Eldev reuses its standard
selector concept for all of Ecukes patterns, anti-patterns, tags and
“run only failing scenarios” option.  It depends on the contents of a
selector:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 71.4286%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>REGEXP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pattern: scenarios with names matching the <code>REGEXP</code> are executed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~REGEXP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Antipattern: scenarios matching the <code>REGEXP</code> are omitted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@TAG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scenarios with given tag (i.e. <code>@TAG</code>) are executed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>~@TAG</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scenarios with the tag are omitted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:failed</code> <em>or</em> <code>:failing</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only scenarios that failed in the previous run are executed</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, command</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev test @foo ~open</pre>
</div>
</div>
<div class="paragraph">
<p>runs all scenarios tagged as <code>@foo</code> with name that doesn’t contain
word <code>open</code>.</p>
</div>
<div class="paragraph">
<p>Unlike the standard (Cask-based) Ecukes test runner, Eldev prints
backtraces of failures in scenario steps by default.  As for all other
supported frameworks, however, this can be disabled using option <code>-B</code>
(<code>--omit-backtraces</code>).  If your project uses only Ecukes tests and you
don’t like the backtraces being printed by default, you can always add
<code>(setf eldev-test-print-backtraces nil)</code> to file <code>Eldev</code>.</p>
</div>
<div class="paragraph">
<p>Option <code>-X</code> (<code>--expect</code>) is currently not supported for this
framework.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="multiple-frameworks">Multiple frameworks in one project</h3>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.10-8be" alt="Since 0.10"></span> Eldev supports using test of different types in one
project, in any combination of supported <a href="#frameworks">frameworks</a>.
In fact, its autodetection will work even in such cases.  However,
especially when using different test types, it might be useful to set
variable <code>eldev-test-framework</code> to a <em>list</em> of the frameworks the
project uses.  E.g.:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>(setf eldev-test-framework '(ert buttercup))</pre>
</div>
</div>
<div class="paragraph">
<p>The order of elements in the list is important, as this will be the
order in which <code>test</code> command calls the different frameworks.</p>
</div>
<div class="paragraph">
<p>Command <code>test</code> will apply all its options and selectors to all
frameworks (autodetected or specified explicitly as above) at once.
Additionally, when tests of different types are invoked, the command
will print a short summary over all types.</p>
</div>
<div class="paragraph">
<p>Often, however, you don’t want to mix different test types and instead
run them using separate commands.  This is especially useful when you
specify selectors, because those are often different across
frameworks.  In this case you can use commands <code>test-FRAMEWORK</code> or
their shorter aliases <code>FRAMEWORK</code>.  The syntax and behavior of these
commands is the same as that of <code>test</code>, with the only difference that
only one, specified, framework is used.  These commands are available
in all project.  However, they are not “advertised”, i.e. not shown in
output of <code>eldev help</code>, unless you set variable <code>eldev-test-framework</code>
to a list of at least two elements.</p>
</div>
<div class="paragraph">
<p>Example usage:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev test-ert
$ eldev ecukes basics.feature</pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to specify filesets that limit test file selection
for each framework, using variables <code>eldev-test-FRAMEWORK-fileset</code>.
If you often use single-framework commands, these filesets can speed
up testing by not loading unneeded files.  For example, if you have
ERT tests in one file called <code>ert.el</code> and a lot of files with
Buttercup tests, you could add this to file <code>Eldev</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>(setf eldev-test-ert-fileset "ert.el"
      eldev-test-buttercup-fileset "!ert.el")</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_loading_test_files">Loading test files</h3>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.5-8be" alt="Since 0.5"></span> There appears to be two common ways of using tests: 1)
they are loaded from project root; 2) subdirectory <code>test/</code> (or
similar) in the project is added to <code>load-path</code>.  Eldev supports both.
First one is the default, since it doesn’t require anything in
addition.</p>
</div>
<div class="paragraph">
<p>To better understand the second way, imagine your project structure is
like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    tests/
        test-helper.el
        test-my-project.el</pre>
</div>
</div>
<div class="paragraph">
<p>and file <code>test-my-project.el</code> includes a form <code>(require
'test-helper)</code>.  Naturally, this setup will work only if subdirectory
<code>tests/</code> is in <code>load-path</code> by the point tests are executed.  To
instruct Eldev that your project needs this, add the following to file
<code>Eldev</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(eldev-add-loading-roots 'test "tests")</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>'test</code> is the command name and <code>"tests"</code> is the name of the
subdirectory that should serve as additional loading root.  In
principle, loading roots can also be used for other commands too, just
like <a href="#additional-dependencies">extra dependencies</a>.</p>
</div>
<div class="paragraph">
<p>If you want to switch to the first way and avoid special forms in file
<code>Eldev</code>, replace <code>(require 'test-helper)</code> with <code>(require
'tests/test-helper)</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="test-results">Reusing previous test results</h3>
<div class="paragraph">
<p><a href="#ert">ERT</a> provides a few selectors that operate on tests’ last
results.  Even though different Eldev executions will run in different
Emacs processes, you can still use these selectors: Eldev stores and
then loads last results of test execution as needed.</p>
</div>
<div class="paragraph">
<p>For example, execute all tests until some fails (<code>-s</code> is a shortcut
for <code>--stop-on-unexpected</code>):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev test -s</pre>
</div>
</div>
<div class="paragraph">
<p>If any fails, you might want to fix it and rerun again, to see if the
fix helped.  The easiest way is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev test :failed</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://www.gnu.org/software/emacs/manual/html_node/ert/Test-Selectors.html">documentation on ERT
selectors</a> — other “special” selectors (e.g. <code>:new</code> or <code>:unexpected</code>)
also work.</p>
</div>
<div class="paragraph">
<p>For <a href="#ecukes">Ecukes</a> there is a comparable feature, though only for
failing scenarios.  Internally it is implemted differently, as it is
built into the framework itself, but from the interface point of view
it works almost exactly the same: specify selector <code>:failed</code> or
<code>:failing</code> on the command line:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev test-ecukes :failed</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="testing-simplifications">Testing command line simplifications</h3>
<div class="paragraph">
<p>When variable <code>eldev-dwim</code> (“do what I mean”) is non-nil, as by
default, Eldev supports a few simplifications of the command line to
make testing even more streamlined.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For all frameworks: any selector that ends in <code>.el</code> (<code>.feature</code> for
<a href="#ecukes">Ecukes</a>) is instead treated as a file pattern.  For
example:</p>
<div class="openblock">
<div class="content">
<div class="literalblock">
<div class="content">
<pre>$ eldev test foo.el</pre>
</div>
</div>
<div class="paragraph">
<p>will work as if you specified <code>-f</code> before <code>foo.el</code>.</p>
</div>
</div>
</div>
</li>
<li>
<p>For <a href="#ert">ERT</a>: any symbol selector that doesn’t match a test name
is instead treated as regular expression (i.e. as a string).  For
example:</p>
<div class="openblock">
<div class="content">
<div class="literalblock">
<div class="content">
<pre>$ eldev test foo</pre>
</div>
</div>
<div class="paragraph">
<p>will run all tests with names that contain <code>foo</code>.  You can achieve the
same result with ‘strict’ command line (see also ERT selector
documentation) like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev test \"foo\"</pre>
</div>
</div>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you dislike these simplifications, set <code>eldev-dwim</code> to <code>nil</code> in
<code>~/.config/eldev/config</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="linting">Linting</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.2-8be" alt="Since 0.2"></span> It might be useful to ensure that your source code follows
certain standards.  There are many programs called linters that can
help you with this.  Several of them are also supported by Eldev and
can be executed using the tool.</p>
</div>
<div class="paragraph">
<p>In its simplest form <code>lint</code> command will execute all supported linters
and let them loose on your source code in <code>main</code> target set:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev lint</pre>
</div>
</div>
<div class="paragraph">
<p>You don’t need to install anything additionally: Eldev will download
and use required packages itself.  Because of this, first linting in a
project might take a while to prepare, but later the downloaded
linters will be reused.</p>
</div>
<div class="paragraph">
<p>Currently, Eldev knows and uses the following linters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Emacs built-in <code>checkdoc</code>.  Verifies documentation strings of your
functions, variables and so on for various style errors.</p>
</li>
<li>
<p><a href="https://github.com/purcell/package-lint"><code>package-lint</code></a>, which detects erroneous package
metadata, missing dependencies and much more.</p>
</li>
<li>
<p><a href="https://github.com/mattiase/relint"><code>relint</code></a> that can detects errors in regular expression
strings in your source code.</p>
</li>
<li>
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.6-8be" alt="Since 0.6"></span> <a href="https://github.com/gonewest818/elisp-lint/"><code>elisp-lint</code></a> that checks Elisp code
for various errors — it is even more versatile than <code>package-lint</code>
and actually optionally includes it.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In future, more linters can gain special treatmeant from Eldev (you
can also leave a feature request in the issue tracker).  The full list
can always be found using command <code>eldev lint --list</code>.</p>
</div>
<div class="paragraph">
<p>Running all the linters at once is not always what you want.  In such
a case you can just specify name (or several) of the linter you want
on the command line:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev lint doc</pre>
</div>
</div>
<div class="paragraph">
<p>Names can be simplified by dropping words “check” and “lint” from
them.  It is also possible to explicitly direct linters at certain
files, rather than verifying all at once:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev lint re -f foo.el</pre>
</div>
</div>
<div class="paragraph">
<p>Like with <a href="#testing-simplifications">testing</a>, you can omit <code>-f</code>
(<code>--file</code>) option above as long as variable <code>eldev-dwim</code> is non-nil.</p>
</div>
<div class="paragraph">
<p>Some projects, however, may decide to follow advices of certain
linters, but not the others.  You can explicitly tell Eldev about
project’s policy by adjusting one or more of variables
<code>eldev-lint-default</code>, <code>eldev-lint-default-excluded</code> and
<code>eldev-lint-disabled</code> in file <code>Eldev</code>.  All of these variables affect
which linters exactly Eldev starts when their names are not specified
explicitly.</p>
</div>
<div class="paragraph">
<p>Command <code>lint</code> sets Eldev’s exit status to non-zero if there is at
least one warning from any requested linter.  This simplifies using
linting in <a href="#continuous-integration">continuous integration</a> should
you want to do that.</p>
</div>
<div class="sect2">
<h3 id="doctor">The doctor</h3>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-1.3-8be" alt="Since 1.3"></span> Eldev comes with a way to “lint” the project and its
checkout too.  Just run:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev doctor</pre>
</div>
</div>
<div class="paragraph">
<p>This will check the project for a few common potential problems.  All
the warnings come with quite verbose explanations, detailing what the
doctor thinks is wrong, why and how to fix that.  However, it’s up to
you to decide what and if anything at all should be done — the doctor
doesn’t, and actually cannot, fix anything itself.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="evaluating">Quickly evaluating expressions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is often useful to evaluate Elisp expressions in context of the
project you develop — and probably using functions from the project.
There are two commands for this in Eldev: <code>eval</code> and <code>exec</code>.  The only
difference between them is that <code>exec</code> doesn’t print results to
stdout, i.e. it assumes that the forms you evaluate produce some
detectable side-effects.  Because of this similarity, we’ll consider
only <code>eval</code> here.</p>
</div>
<div class="paragraph">
<p>The basic usage should be obvious:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev eval "(+ 1 2)"</pre>
</div>
</div>
<div class="paragraph">
<p>Of course, evaluating <code>(+ 1 2)</code> form is not terribly useful.  Usually
you’ll want to use at least one function or variable from the project.
However, for that you need your project not only to be in <code>load-path</code>
(which Eldev guarantees), but also <code>require</code>d.  Luckily, you don’t
have to repeat <code>(require 'my-package)</code> all the time on the command
line, as Eldev does this too, so normally you can just run it like
this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev eval "(my-package-function)"</pre>
</div>
</div>
<div class="paragraph">
<p>What Eldev actually does is requiring all features listed in variable
<code>eldev-eval-required-features</code>.  If value of that variable is symbol
<code>:default</code>, value of <code>eldev-default-required-features</code> is taken
instead.  And finally, when value of the latter is symbol
<code>:project-name</code>, only one feature with the same name as that of the
project is required.  In 95% of the cases this is exactly what you
need.  However, if the main feature of the project has a different
name, you can always change the value of one of the mentioned
variables in file <code>Eldev</code>.</p>
</div>
<div class="paragraph">
<p>It can also make sense to change the variable’s value in <code>Eldev-local</code>
if you want certain features to always be available for quick testing.</p>
</div>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.11-8be" alt="Since 0.11"></span> If you have larger scripts to evaluate (but still not as
standard as to abstract as a custom builder or a command), you can
evaluate expressions stored in a file using <code>--file</code> (<code>-f</code>) option:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev eval -f useful-expressions.el</pre>
</div>
</div>
<div class="paragraph">
<p>Note that this is <em>not</em> performed using Elisp file loading.  Instead,
the file is parsed as a sequence of Elisp expression and those are
then evaluated/executed in exactly the same way as if specified on the
command line.  In particular, for command <code>eval</code> results are still
printed after every expression, even if they all come from the same
file.  As in several other places, when variable <code>eldev-dwim</code> (“do
what I mean”) is non-nil, option <code>-f</code> can be omitted as long as
filename ends in <code>.el</code>.  In other words, you can just invoke:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev eval useful-expressions.el</pre>
</div>
</div>
<div class="paragraph">
<p>for the expected effect.</p>
</div>
<div class="paragraph">
<p>To simplify command-line usage a bit, commands accept multiple
expressions in one parameter, to reduce the number of quotes to type.
E.g.:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev eval "(+ 1 2) (+ 3 4)"
3
7</pre>
</div>
</div>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-1.1-8be" alt="Since 1.1"></span> There are “magic” variables called <code>@</code>, <code>@1</code>, <code>@2</code> and so
on, aimed at simplifying accessing to previous form results from
subsequent forms.  Variable <code>@</code> always holds the result of previous
form evaluation; it is thus not available in the very first form.
Variables <code>@N</code>, where <code>N</code> is a number, hold result of <code>N</code>’s form (<code>N</code>
starts with 1, not 0).  They can be used both in <code>eval</code> and <code>exec</code>,
even if the latter doesn’t print the results.</p>
</div>
<div class="paragraph">
<p>All forms for evaluation/execution are indexed with the same number
sequence, regardless if they come from command line (including
multiple forms per parameter) or from a file.</p>
</div>
<div class="paragraph">
<p>To illustrate:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev eval "(generate-new-buffer \"abc\") (buffer-name @)"
#&lt;buffer abc&gt;
"abc"</pre>
</div>
</div>
<div class="paragraph">
<p>Or:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev eval "(+ 1 2) (+ 3 4) (* @1 @2)"
3
7
21</pre>
</div>
</div>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.11-8be" alt="Since 0.11"></span> Commands <code>eval</code> and <code>exec</code> also have a few options aimed
at code profiling.  See <a href="#profiling-eval">relevant section below</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-emacs">Running Emacs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes you want to run Emacs with <em>just</em> your project installed and
see how it works without any customization.  You can achieve this in
Eldev easily:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev emacs</pre>
</div>
</div>
<div class="paragraph">
<p>This will spawn a separate Emacs that doesn’t read any initialization
scripts and doesn’t have access to your usual set of installed
packages, but instead has access to the project being built with Eldev
— and its dependencies, of course.  Similar as with <code>eval</code> and <code>exec</code>
commands, features listed in variable <code>eldev-emacs-required-features</code>
are required automatically.</p>
</div>
<div class="paragraph">
<p>You can also pass any Emacs options through the command line.  For
example, this will visit file <code>foo.bar</code>, which is useful if your
project is a mode for <code>.bar</code> files:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev emacs foo.bar</pre>
</div>
</div>
<div class="paragraph">
<p>See <code>emacs --help</code> for what you can specify on the command line.</p>
</div>
<div class="paragraph">
<p>When issued as shown above, command <code>emacs</code> will pass the rest of the
command line to Emacs, but also add a few things on its own.  First,
it adds everything from the list <code>eldev-emacs-default-command-line</code>,
which disables <code>~/.emacs</code> loading and similar things.  Second, it
transfers variables listed in <code>eldev-emacs-forward-variables</code> to the
child process (this is done in order to keep
<a href="#project-isolation">project isolation</a> promises).  Third, adds
<code>--eval</code> arguments to require the features as described above.  And
only after that comes the actual command line you specified.</p>
</div>
<div class="paragraph">
<p>Occasionally you might not want this behavior.  In this case, prepend
<code>--</code> to the command line — then Eldev will pass everything after it to
the spawned Emacs as-is (with the exception of still transferring
variables listed in <code>eldev-emacs-forward-variables</code>).  Remember that
you will likely need to pass at least <code>-q</code> (<code>--no-init-file</code>) option
to Emacs, otherwise it will probably fail on your <code>~/.emacs</code> since it
will not see your usual packages.  To illustrate:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev emacs -- -q foo.bar</pre>
</div>
</div>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-1.3-8be" alt="Since 1.3"></span> The whole Eldev infrastracture including its functions are
available by default in the launched Emacs too (can be changed in
<code>eldev-emacs-autorequire-eldev</code>).  This is done largely so that 1)
configuration (files <code>Eldev</code>, <code>Eldev-local</code> etc.) takes effect also in
the interactive Emacs; 2) <a href="#debugging-features">various debugging
functions</a> can be easily used there too.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="profiling">Profiling</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.11-8be" alt="Since 0.11"></span> Eldev has limited built-in support for profiling your
project.  The largest limitation here is Emacs itself: it is difficult
to receive a useful code profile, as provided functionality is really
basic and crude.</p>
</div>
<div class="paragraph">
<p>Profiling is implemented as a “prefix” command, which takes the “real”
command as an argument.  This way, anything can be profiled, though of
course it is really useful only with commands <code>eval</code>, <code>exec</code> and
<code>test</code>, maybe occasionally with <code>compile</code> and similar.</p>
</div>
<div class="paragraph">
<p>The basic usage is like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev profile --open eval "(my-project-function)"</pre>
</div>
</div>
<div class="paragraph">
<p>Option <code>--open</code> tells Eldev to send resulting profile(s) to your
normal Emacs and open there.  It provides the quickest way to examine
results of profiling.  For it to work, Emacs must run a server, see
function <code>server-start</code>.  Another alternative is to store results into
a file, using <code>--file</code> option, though opening this in Emacs is
currently (28.1) fairly difficult.  At least one of <code>--open</code> and
<code>--file</code> (can be abbreviated as <code>-o</code> and <code>-f</code>) is required.</p>
</div>
<div class="paragraph">
<p>Eldev is smart enough to start profiling only immediately before
running code from your project, i.e. to avoid profiling project
dependency installation (if that is needed) and so on.  However, it is
apparently not possible to exclude irrelevant stuff from backtraces,
so those will, unfortunately, contain quite a lot of entries not
related to your project.</p>
</div>
<div class="paragraph">
<p>Like with Elisp function <code>profiler-start</code>, you can choose between CPU,
memory and both together using options <code>--cpu</code>, <code>--mem</code> and <code>cpu-mem</code>
(or <code>-c</code>, <code>-m</code> and <code>-M</code>).  Default profiling mode is CPU.</p>
</div>
<div class="sect2">
<h3 id="profiling-eval">Useful evaluation options</h3>
<div class="paragraph">
<p>Profiling is most useful with commands <code>eval</code> and <code>exec</code>.
Additionally, those have certain options targeted especially at
profiling, though they could, of course, be used in other cases.</p>
</div>
<div class="paragraph">
<p>Options <code>--macroexpand</code> and <code>--compile</code> (<code>-m</code> and <code>-c</code>) make the
commands preprocess their expressions accordingly; by default
expressions are simply evaluated using Elisp interpreter.</p>
</div>
<div class="paragraph">
<p>Option <code>--repeat</code> (<code>-n</code>) lets you evaluate the same expression(s)
multiple times.  This is useful if normal evaluation is too fast for a
meaningful profile.  If the command <code>eval</code> is used, only the last
result is printed.  However, any side effects (including printing)
will be observable that many times, so keep that in mind!</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev profile -o eval -c -n 10000 "..."</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="different-emacs-versions">Executing on different Emacs versions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since Eldev itself is an Elisp program, version of Emacs you use can
affect any aspect of execution — even before it gets to running
something out of your project.  Therefore, inside its “cache”
directory called <code>.eldev</code>, the utility creates a subdirectory named
after Emacs version it is executed on.  If it is run with a different
Emacs, it will not use dependencies or previous test results, but
rather install or recompute them from scratch.</p>
</div>
<div class="paragraph">
<p>Normally, Eldev uses command <code>emacs</code> that is supposed to be resolvable
through <code>PATH</code> environment variable.  However, you can always tell it
to use a different Emacs version, though in this case, Eldev cannot
install it for you, since this is much more complicated than
installing <em>Elisp packages</em>.  You need to make sure that Emacs of
desired version is available on your machine (and can be looked up via
<code>PATH</code>) as an executable — either by installing via your OS’s package
manager, compiling from sources or maybe using <a href="#evm">EVM</a>.  Once you
have it installed, you can tell Eldev to use it by setting either
<code>ELDEV_EMACS</code> or just <code>EMACS</code> in the environment, e.g.:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ EMACS=emacs25 eldev eval emacs-version</pre>
</div>
</div>
<div class="paragraph">
<p>This is especially useful for testing your project with different
Emacs versions.</p>
</div>
<div class="paragraph">
<p>Remember, however, that Eldev cannot separate byte-compiled files
(<code>.elc</code>) from sources.  From documentation of
<code>byte-compile-dest-file-function</code>:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Note that the assumption that the source and compiled files are found
in the same directory is hard-coded in various places in Emacs.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Therefore, if you use byte-compilation and switch Emacs versions,
don’t forget to clean the directory.</p>
</div>
<div class="sect2">
<h3 id="docker">Using Docker</h3>
<div class="paragraph">
<p>Alternatively, if you are on a Linux or macOS system and have
<a href="https://www.docker.com/">Docker</a> installed, you can run arbitrary Eldev commands
within containers based on the images distributed by
<a href="https://github.com/Silex/docker-emacs">docker-emacs</a>.  For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev docker 27.2 emacs --eval '(insert (format "Emacs version: %s" emacs-version))'</pre>
</div>
</div>
<div class="paragraph">
<p>will start an Emacs 27.2 container and run <code>eldev emacs --eval
'(insert (format "Emacs version: %s" emacs-version))'</code> in it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You may have to run <code>xhost +local:root</code> which allows the Docker
container to make connections to the host X server.  However, this
does come with some security considerations, see <code>man xhost</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This command can be used not only to start Emacs of given version, but
to run <em>any</em> Eldev command.  For example, run project’s tests on an
older editor version:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev docker 25.3 test</pre>
</div>
</div>
<div class="paragraph">
<p>or evaluate something using project’s functions:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev docker 26.3 eval "(my-project-read-data \"foo.bin\")"</pre>
</div>
</div>
<div class="paragraph">
<p>Docker’s output is forwarded to normal Eldev output, however, because
of <a href="https://debbugs.gnu.org/cgi/bugreport.cgi?bug=56745">Elisp limitations</a>, it all ends up on
Eldev’s stdout!  There might also be unwieldy delays, so that output
doesn’t come smoothly as generated by the process inside Docker, but
instead in larger chunks.  Before Eldev 1.2 the output would instead
only appear when Docker has exited.</p>
</div>
<div class="paragraph">
<p>It is also possible to use a custom image.  For this, replace Emacs
version argument (26.3 in the last example above) with the full image
name.  The image must contain a preinstalled Emacs of a version
supported by Eldev (i.e. 24.4 and up), but not Eldev itself.</p>
</div>
<div class="paragraph">
<p>Additionally, <code>docker run</code> arguments are customisable via the variable
<code>eldev-docker-run-extra-args</code>.  For example, adding the following to
your project’s <code>Eldev</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>(setf eldev-docker-run-extra-args '("--name" "my_cool_container"))</pre>
</div>
</div>
<div class="paragraph">
<p>will set the container name to “my_cool_container”.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="continuous-integration">Continuous integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Because of Eldev’s trivial installation and built-in support for
testing, it is a suitable tool for use on continuous integration
servers.  But of course this only applies if the test framework your
project uses is already supported (currently <a href="#ert">ERT</a>,
<a href="#buttercup">Buttercup</a> and <a href="#ecukes">Ecukes</a>).</p>
</div>
<div class="sect2">
<h3 id="github-workflows">GitHub workflows</h3>
<div class="paragraph">
<p>The easiest option for continuous integration for GitHub-hosted
projects are <a href="https://help.github.com/en/actions">GitHub workflows</a>, as this doesn’t
involve using a 3rd-party service.  Probably most of Elisp projects
can take advantage of this, since GitHub appears to be the most
popular hosting for Elisp projects.</p>
</div>
<div class="paragraph">
<p>Workflow definition files for GitHub are somewhat more verbose than
for <a href="#travis-ci">Travis CI</a>, but ultimately not really more
complicated.  The easiest way to install Emacs binary of appropriate
version is to use <a href="https://github.com/purcell/setup-emacs"><code>purcell/setup-emacs</code></a> action
(which internally uses <a href="https://github.com/purcell/nix-emacs-ci">nix-emacs-ci</a>).  Since
<a href="https://github.com/rejeep/evm">EVM</a> seems tuned to Ubuntu Trusty (i.e. what Travis CI
provides), it is likely unsuitable for GitHub workflows.</p>
</div>
<div class="paragraph">
<p>There is a short shell script that installs Eldev itself for use on
GitHub runners.  Modifying <code>PATH</code> there is a bit tricky, so you
probably should just go with the script, as demonstrated below.</p>
</div>
<div class="paragraph">
<p>A basic workflow file (you can e.g. name it
<code>.github/workflows/test.yml</code>) would look something like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>name: CI

on:
  push:
    paths-ignore:
      - '**.md'
  pull_request:
    paths-ignore:
      - '**.md'

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        emacs_version:
          # Add more lines like this if you want to test on different Emacs versions.
          - 26.3

    steps:
    - name: Set up Emacs
      uses: purcell/setup-emacs@master
      with:
        version: ${{matrix.emacs_version}}

    - name: Install Eldev
      run: curl -fsSL https://raw.github.com/doublep/eldev/master/webinstall/github-eldev | sh

    - name: Check out the source code
      uses: actions/checkout@v3

    - name: Test the project
      run: |
        eldev -p -dtT test</pre>
</div>
</div>
<div class="paragraph">
<p>Eldev’s terminal autorecognition doesn’t work on GitHub machines
(unlike e.g. on Travis CI).  If you want colored output from Eldev,
you need to explicitly enable it using <code>-C</code> (<code>--color</code>) global option.</p>
</div>
</div>
<div class="sect2">
<h3 id="travis-ci">Travis CI</h3>
<div class="paragraph">
<p><a href="https://travis-ci.org/">Travis CI</a> is perhaps the most used continuous
integration service for Elisp code, at least until the addition of
<a href="#github-workflows">GitHub workflows</a>.  The largest problem on Travis
CI is to install Emacs binary of the desired version.  Luckily, there
are tools that can be used for this: at least <a href="https://github.com/rejeep/evm">EVM</a> and
<a href="https://github.com/purcell/nix-emacs-ci">nix-emacs-ci</a>.</p>
</div>
<div class="sect3">
<h4 id="evm">EVM</h4>
<div class="paragraph">
<p>One of the tools to install Emacs is <a href="https://github.com/rejeep/evm">EVM</a>.  Steve Purcell
(the author of <code>nix-emacs-ci</code>) mentions “various issues” he has had
with it, however many projects use it.  Apparently, you need to fix
Ubuntu distribution used at Travis CI to Trusty for EVM-provided
binaries.  Also note that EVM provides binaries only for Linux, so if
you want test on macOS too, <code>nix-emacs-ci</code> is a better choice.</p>
</div>
<div class="paragraph">
<p>If you also want to try it, Eldev provides a simple script
specifically for use on Travis CI that installs Eldev and EVM in one
go.  Here is a simple project-agnostic <code>.travis.yml</code> file that you can
use as a basis:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>language: emacs-lisp
dist: trusty

env:
  # Add more lines like this if you want to test on different Emacs versions.
  - EVM_EMACS=emacs-26.3-travis

install:
  - curl -fsSL https://raw.github.com/doublep/eldev/master/webinstall/travis-eldev-and-evm &gt; x.sh &amp;&amp; source ./x.sh
  - evm install $EVM_EMACS --use

script:
  - eldev -p -dtT test</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nix_emacs_ci">nix-emacs-ci</h4>
<div class="paragraph">
<p>A newer tool to install Emacs is <a href="https://github.com/purcell/nix-emacs-ci">nix-emacs-ci</a>.  Using
it is easy: define environment variable <code>EMACS_CI</code> with the desired
Emacs version and <code>curl</code> a single shell script — whether on Linux or
macOS.  With one more line you can also install Eldev.  It appears to
be slower than EVM, but for continuous integration that’s not terribly
important.</p>
</div>
<div class="paragraph">
<p>A basic <code>.travis.yml</code> would look like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>language: nix

env:
  # Add more lines like this if you want to test on different Emacs versions.
  - EMACS_CI=emacs-26-3

install:
  - bash &lt;(curl https://raw.githubusercontent.com/purcell/nix-emacs-ci/master/travis-install)
  - curl -fsSL https://raw.github.com/doublep/eldev/master/webinstall/travis-eldev &gt; x.sh &amp;&amp; source ./x.sh

script:
  - eldev -p -dtT test</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="circle-ci">CircleCI</h3>
<div class="paragraph">
<p>Another frequently used service is <a href="https://circleci.com/">CircleCI</a>.  I don’t
know that much about it, presumably <a href="https://github.com/purcell/nix-emacs-ci">nix-emacs-ci</a> can
be used to install Emacs on it.  Some projects successfully use
<a href="https://www.docker.com/">Docker</a> images.</p>
</div>
<div class="paragraph">
<p>Regardless of how you install Emacs, adding Eldev is yet another
one-liner.  It is handy to use, because propagating <code>PATH</code>
modifications between different commands on CircleCI is somewhat
non-obvious.  To use it, add the following lines in the relevant place
in file <code>.circleci/config.yml</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    ...
    - run:
        name: Install Eldev
        command: curl -fsSL https://raw.github.com/doublep/eldev/master/webinstall/circle-eldev &gt; x.sh &amp;&amp; source ./x.sh</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_script_commands">Script commands</h3>
<div class="paragraph">
<p>Once you have Emacs with Eldev set up on the continuous integration
server of your choice, it is time to actually test your project.  The
most basic command is, naturally, <code>eldev test</code>.  You might want to add
a few options to both make project loading more similar to that
typical for your users and Eldev’s output more informative:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev -p -dtT test</pre>
</div>
</div>
<div class="paragraph">
<p>To make sure that your project byte-compiles cleanly, use the
following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev -dtT compile --warnings-as-errors</pre>
</div>
</div>
<div class="paragraph">
<p>Or maybe even this, if you want to make sure that test <code>.el</code> files
also can be byte-compiled without warnings (this can sometimes catch
more problems):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev -dtT compile --set all --warnings-as-errors</pre>
</div>
</div>
<div class="paragraph">
<p>You can also enforce conformance to certain coding standards by adding
an invocation of <code>lint</code> to the <code>script</code> part.  Remember, however, that
most linters are continuously being developed.  Even if a linter finds
your source warning-free today, it might detect problems tomorrow.
<code>relint</code> is probably one of the “safer” linters in this regard:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev -dtT lint re</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="debugging-features">Debugging features</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Eldev comes with lots of different options and other features that can
help you debug problems both in your project, Eldev itself or your
Eldev scripts.</p>
</div>
<div class="paragraph">
<p>File <code>Eldev-local</code> provides a good place to install temporary advices,
overwrite Emacs functions etc. in the process of debugging certain
problems.</p>
</div>
<div class="sect2">
<h3 id="_debugging_output">Debugging output</h3>
<div class="paragraph">
<p>There are two common ways of debugging code: interactively, using a
debugger program to step through the code and determine at which place
things go wrong, and non-interactively, by adding <em>debugging output</em>
to relevant places in the code.  While Eldev cannot really help you
with interactive debugging, it provides several functions useful for
generating debugging output.</p>
</div>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-1.3-8be" alt="Since 1.3"></span> The main such function is predictably called
<code>eldev-debug</code>.  It accepts the same arguments as <code>message</code> and writes
the output to stderr in a standing-out color.</p>
</div>
<div class="paragraph">
<p>If you <a href="#running-emacs">launch interactive Emacs</a> with your project,
output of the function comes to <em>Emacs</em> stderr, i.e. the console from
which you have started up Eldev.  This makes debugging output more
visible and easily relatable to things going on in Emacs: you have two
separate OS-level windows and just need to arrange them in such a way
that they don’t cover each other.  Additionally, <a href="#setup-procedure">the
whole project setup procedure</a> is repeated in such Emacs instances,
so e.g. files <code>Eldev</code> or <code>Eldev-local</code> can easily affect those too.</p>
</div>
<div class="paragraph">
<p>You can call <code>eldev-debug</code> from your project’s code directly or from
an advice defined in <code>Eldev-local</code>.  E.g. you could temporarily add
something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(defadvice my-function (around debug-it activate)
  ad-do-it
  (eldev-debug "my-function %S -&gt; %S" (ad-get-args 0) ad-return-value))</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will log all calls to <code>my-function</code> on the stderr, along with
arguments and produced result.</p>
</div>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-1.4-8be" alt="Since 1.4"></span> If you need to see how several functions call each other,
linear logs produced by advices as above may be too confusing.  In
such a case you may be interested in macro
<code>eldev-nest-debugging-output</code>, which indents <em>all</em> Eldev-generated
debugging output inside its body.  It is also useful to split output
shown above into two lines: one for when a function gets called and
another — when it returns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(defadvice my-function-1 (around debug-it activate)
  (eldev-debug "my-function-1 %S" (ad-get-args 0))
  (eldev-nest-debugging-output ad-do-it)
  (eldev-debug "-&gt; %S" ad-return-value))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming you have similar advices for other functions that call each
other, output might look something like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>my-function-1 (...)
  my-function-2 (...)
    my-function-3 (...)
    -&gt; [RESULT OF my-function-3]
  -&gt; [RESULT OF my-function-2]
-&gt; [RESULT OF my-function-1]</pre>
</div>
</div>
<div class="paragraph">
<p>Macro <code>eldev-dump</code> reuses <code>eldev-debug</code> to show the current value of
its argument variable(s) or even arbitrary form(s) in a human readable
way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(eldev-dump load-prefer-newer (* 10 10))</code></pre>
</div>
</div>
<div class="paragraph">
<p>prints</p>
</div>
<div class="literalblock">
<div class="content">
<pre>load-prefer-newer = t
(* 10 10) = 100</pre>
</div>
</div>
<div class="paragraph">
<p>This allows you to save some typing on debugging output forms that are
meant to be temporary anyway and get changed quickly.</p>
</div>
<div class="paragraph">
<p>A pretty useful function to generate debugging output is
<code>eldev-backtrace</code>.  In some cases it is quite difficult to understand
<em>how</em> a function gets called (with given arguments).  Seeing a
backtrace can help you out.  Using different project
<a href="#loading-modes">loading modes</a> can be useful here: sometimes a
backtrace in a byte-compiled code is more readable and provides the
information you need, while in other cases you rather need
non-compiled forms.</p>
</div>
<div class="paragraph">
<p>Macro <code>eldev-time-it</code> can be used to roughly estimate performance of
pieces of code and understand where your project becomes too slow.</p>
</div>
<div class="paragraph">
<p>Functions and macros above also come in “conditional” form: just add
<code>x</code> before function name, e.g. <code>eldev-xdebug</code>, <code>eldev-xdump</code>, etc.
These functions by default do nothing, but can be activated or
deactivated using <code>eldev-enabling-xdebug</code>, <code>eldev-disabling-xdebug</code>
and <code>eldev-maybe-xdebug</code> macros.  Global option <code>-x</code> also activates
them initially (can still be deactivated programmatically later).
Appropriate usage can drastically reduce debugging output size in a
deeply nested calltree and limit it to only relevant (to the bug you
are investigating) portions.</p>
</div>
<div class="paragraph">
<p>Another technique to reduce debugging output is to activate it only
after the project has been fully loaded and initialized — depending on
the project, the setup can involve quite a lot of function calls on
its own, e.g. from computation of constants, <code>eval-when-compile</code> forms
and so on.  In this case it might be useful to install debugging
advices inside a <code>with-eval-after-load</code> form.</p>
</div>
</div>
<div class="sect2">
<h3 id="_preventing_accidental_commits">Preventing accidental commits</h3>
<div class="paragraph">
<p>It is, generally, a good idea to use Eldev calls only in files <code>Eldev</code>
and <code>Eldev-local</code>.  Actual project source code should be limited to
using Eldev only while debugging — in all other cases Eldev is hardly
a proper dependency, at least for most projects.  However, as I have
found from experience, it is pretty easy to forget and accidentally
commit debugging output changes that were meant only as a temporary
aid for investigating one specific issue.</p>
</div>
<div class="paragraph">
<p>If you use Git as your VCS, you may want to employ Git hooks that
prevent such accidental commits.  Eldev even has a <a href="#githooks">special
command</a> for that.</p>
</div>
</div>
<div class="sect2">
<h3 id="_debugging_setup_scripts">Debugging setup scripts</h3>
<div class="paragraph">
<p>The following is an overview of Eldev features that can help you in
debugging project setup scripts and Eldev — which is also not
bug-proof — itself.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Global options <code>-t</code> (<code>--trace</code>), <code>-v</code> (<code>--verbose</code>) and <code>-q</code>
(<code>--quiet</code>) control the amount of output Eldev generates.  The first
one makes Eldev extra verbose, helping you to understand what it is
doing and at which step something goes wrong.</p>
</li>
<li>
<p>Global option <code>-d</code> (<code>--debug</code>) makes Eldev print backtrace if it
dies with a Elisp signal (except certain well-defined and explained
errors like a missing dependency).</p>
</li>
<li>
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.3-8be" alt="Since 0.3"></span> Global option <code>-Q</code> (<code>--backtrace-on-abort</code>) makes Eldev
print backtrace if it is aborted with <code>^C</code>.  This is useful if your
project freezes or has very bad performance, and you want to figure
out where exactly this happens.</p>
</li>
<li>
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.8-8be" alt="Since 0.8"></span> Global option <code>-b</code> (<code>--backtrace</code>) lets you adapt
backtraces to your screen width and thus make them more readable at
the expense of completeness (by default, Eldev doesn’t truncate
backtrace lines).  It is a good idea to change the default in file
<code>~/.config/eldev/config</code>.  Starting with 0.10 this also affects
backtraces printed if Eldev or code from the project it executes
fails with a signal (see also option <code>--debug</code>).</p>
</li>
<li>
<p>Global option <code>-T</code> (<code>--time</code>) prepends timestamps to all lines of
Eldev output, making it easier to spot performance problems.</p>
</li>
<li>
<p>Command <code>prepare</code> can be used to install all project dependencies —
and thus check if they and package archives are specified correctly
— without doing anything else.</p>
</li>
<li>
<p>Commands <code>deps</code> (<code>dependencies</code>) and <code>dtree</code> (<code>dependency-tree</code>) can
be used to display list or tree of project dependencies, which is
especially useful for large projects unfamiliar to you.</p>
</li>
<li>
<p>For many errors, Eldev will print additional hints (unless you
specify option <code>--quiet</code>).  For example: if an error happens during
evaluating file <code>Eldev</code>, the tool will mention this; if a dependency
cannot be installed, Eldev will mention what required this
dependency (can be non-obvious in larger packages).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_plugins">Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.3-8be" alt="Since 0.3"></span> Plugins are activatable extensions to Eldev functionality.
They provide features that are not needed for most projects and
are therefore not enabled by default.  However, enabling a plugin is
trivial — just add line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(eldev-use-plugin 'PLUGIN-NAME)</code></pre>
</div>
</div>
<div class="paragraph">
<p>to file <code>Eldev</code> of your project.  For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(eldev-use-plugin 'autoloads)</code></pre>
</div>
</div>
<div class="paragraph">
<p>As for other configuration, you can also do it in <code>Eldev-local</code> or
<a href="#setup-procedure">other places</a>.</p>
</div>
<div class="paragraph">
<p>In future, plugins may become externally-managed and “detached” from
Eldev itself (create an issue if you are interested).  For now,
however, Eldev provides three built-in plugins.</p>
</div>
<div class="paragraph">
<p>You can check if a project has any plugins activated — and
documentation for those plugins:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev plugins</pre>
</div>
</div>
<div class="paragraph">
<p>Run Eldev in quiet mode (<code>-q</code>) to get only the list, without the long
documentation:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev -q plugins</pre>
</div>
</div>
<div class="paragraph">
<p>Remember that if a project activates a plugin in a non-standard way,
for example from <a href="#hooks">a hook</a>, command <code>plugins</code> will not see it.</p>
</div>
<div class="paragraph">
<p>There is currently no way to list all available plugins.  However, as
of yet there are only three plugins anyway.</p>
</div>
<div class="sect2">
<h3 id="autoloads-plugin">autoloads</h3>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.6-8be" alt="Since 0.6"></span> A plugin that enables automatic collection of functions
and other forms marked with <code>;;;###autoload</code> cookie in project’s <code>.el</code>
files.  It tries to behave exactly the same as for installed Elisp
packages, so that there are no differences between development and
installed versions of the project.</p>
</div>
<div class="paragraph">
<p>The plugin is not on by default because many projects don’t use
autoloading functionality at all and having file
<code>PACKAGE-autoloads.el</code> magically appear all the time in them would be
annoying.</p>
</div>
<div class="paragraph">
<p>To have autoloads automatically collected in your project, just
activate the plugin: add form <code>(eldev-use-plugin 'autoloads)</code> to the
project’s file <code>Eldev</code>.  You don’t need any additional steps to
instruct Eldev how to use the generated file.  In fact, it is able to
do this even without the plugin: the plugin only takes cares to build
and update the file as necessary.</p>
</div>
<div class="paragraph">
<p>If the plugin is activated, you can see new target <code>:autoloads</code> in the
output of <code>targets</code> command.  In addition to being built by default,
this file is also generated whenever Eldev needs to load the project:
for commands <code>test</code>, <code>eval</code>, <code>exec</code> and <code>emacs</code>.  Finally, the file is
also registered as a dependency to all <code>.elc</code> targets in the project;
this way, byte-compiling always has access to up-to-date list of
autoloaded functions.</p>
</div>
<div class="paragraph">
<p>This plugin can also be activated in projects you use as
<a href="#local-dependencies">local dependencies</a> for other projects.  Eldev
knows how to keep the autoloads file up-to-date in all local
dependencies, regardless of their <a href="#loading-modes">loading mode</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="maintainer-plugin">maintainer</h3>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-1.2-8be" alt="Since 1.2"></span> This is a special plugin that adds commands for project’s
maintainer use, in fact, currently just one: <code>release</code>.  Because not
every developer is a maintainer, this command is not enabled by
default and is instead available only when the plugin is active, to
avoid potential confusion.  The recommended way to activate it,
therefore, is by adding code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(eldev-use-plugin 'maintainer)</code></pre>
</div>
</div>
<div class="paragraph">
<p>to your (as maintainer’s) personal file <code>Eldev-local</code>.  You can also
do this in <code>~/.config/eldev/config</code> to have the commands available
everywhere.  If you are the only developer of your project (or simply
don’t care), you can of course do this right in file <code>Eldev</code>.</p>
</div>
<div class="paragraph">
<p>The plugin defines a lot of variables that control its behavior.  They
are available even if the plugin itself is not active, and it is
actually recommended to set them in file <code>Eldev</code>, so that if the
plugin <em>is</em> activated, project-specific configuration is already
present.</p>
</div>
<div class="sect3">
<h4 id="_command_release">Command <code>release</code></h4>
<div class="paragraph">
<p>The main plugin’s command is called <code>release</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev release VERSION</pre>
</div>
</div>
<div class="paragraph">
<p>By default it runs interactively.  As always in Eldev, this can be
changed from command line (option <code>-N</code> makes the command
non-interactive) or customized in <code>~/.config/eldev/config</code>.  The
command refuses to release the project if any <em>validation</em> step fails
(when running interactively, you can override this in some cases).  It
won’t push any resulting commits: this is left for you to do
explicitly.</p>
</div>
<div class="paragraph">
<p>This command is relatively simplistic.  If you need really advanced
functionality, try looking for an external tool, e.g.
<a href="https://github.com/release-it/release-it">Release-It</a>.  Some external tools may be blendable
into Eldev’s plugin via <code>eldev-release-validators</code> etc., see
<a href="#maintainer-settings">below</a>.</p>
</div>
<div class="paragraph">
<p>There are four standard validation steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check the version.  It must be valid from Elisp point of view and
larger than the current project’s version.  You can also specify one
of <em>incrementors</em> by name: “major”, “minor”, “patch” or “snapshot”
to have a suitable version number automatically generated for you
based on the current version.  Normally you need to specify this on
the command line, but when running the command interactively, you
can also type it in at runtime.</p>
</li>
<li>
<p>Check the project’s working directory.  It must be a Git or
Mercurial checkout; the command won’t work in non-VCS directories or
those belonging to a different VCS at all.  The directory must not
contain any modifications or unknown files (the latter can be
“allowed” using option <code>--ignore-unknown</code>, <code>-u</code>).  Finally, Eldev
can refuse releasing from certain branches, by default from anywhere
but Git’s “master” or Mercurial’s “default”.</p>
</li>
<li>
<p>Check the project’s files.  Eldev will refuse to release if any file
contains a run-together word “DONOTRELEASE” (configurable).
This can be left as a reminder to self, for example, as a comment in
any file in a place that must be fixed before making a release.
This precaution can be skipped with option <code>--no-file-checks</code> or
manually when running interactively.</p>
</li>
<li>
<p>Optionally test the project by running its tests and byte-compiling.
This step requires configuration and by default won’t do anything.
This is actually not a problem if you have
<a href="#continuous-integration">continuous integration</a> properly set up.
However, the plugin is currently unable to check results on
CI-servers automatically and instead relies on you “knowing what you
are doing”.</p>
<div class="paragraph">
<p>Testing can be skipped with option <code>--no-testing</code> in case you know it
passes on a CI-server or really need to make a release immediately,
even with known failures.  In the interactive mode you can also choose
to proceed even if some tests fail.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the validation passes or if you have interactively chosen to ignore
the errors, Eldev proceeds to create the release commit and tag the
release.  Depending on the project configuration, it may additionally
create a post-release commit (not by default).</p>
</div>
<div class="paragraph">
<p>Command <code>release</code> is written to be as generic as possible.  Eldev
defines a lot of variables that control its behavior.  However, they
are not available from the command line.  Instead, they should be
customized in file <code>Eldev</code> on a per-project basis; see the next
section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_command_update_copyright">Command <code>update-copyright</code></h4>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-1.3-8be" alt="Since 1.3"></span> The plugin provides a very simple command to update
copyright notices, based on Emacs’ built-in feature <code>copyright</code>.  You
can run it simply as:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev update-copyright</pre>
</div>
</div>
<div class="paragraph">
<p>to update the notices everywhere in the project to include the current
year, or as e.g.:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev update-copyright 2023</pre>
</div>
</div>
<div class="paragraph">
<p>to include a specific year in the notices.  Unlike command <code>release</code>,
this doesn’t create any VCS commits: it leaves the files modified for
you to validate and commit the changes.</p>
</div>
</div>
<div class="sect3">
<h4 id="maintainer-settings">Maintainer project-specific settings</h4>
<div class="paragraph">
<p>You can and most often should adapt the plugin to your project’s
needs.  There are really lots of variables that control command
<code>release</code> behavior.  They have sensible defaults, but your project,
especially if it is complicated, still might need to tweak some of
them.  For command <code>update-copyright</code> you may want to change the value
of <code>eldev-update-copyright-fileset</code>.</p>
</div>
<div class="paragraph">
<p>Not every variable is listed here.  You can always check Eldev source
code and in-Emacs documentation to find all <code>eldev-release-…</code>
variables if you need yet more customization.</p>
</div>
<h5 id="_project_name_and_commit_messages" class="discrete">Project name and commit messages</h5>
<div class="paragraph">
<p>First variable you might need to set is called
<code>eldev-formatted-project-name</code>.  By default it has no value and
Elisp-level <em>package</em> name is used in its place.  This is often not a
bad default, but package names are typically all-lowercase.  By
default the name also makes it into commit messages.</p>
</div>
<div class="paragraph">
<p>It might also be necessary to modify <code>eldev-release-commit-message</code>
and <code>eldev-release-post-release-commit-message</code>.  These variables
<em>are</em> accessible from command line, but if you always use standard
messages when releasing, you can save yourself some typing by entering
them once in file <code>Eldev</code>.  Messages set here may contain
placeholders, see function <code>eldev-substitute</code> for details.</p>
</div>
<h5 id="_validators" class="discrete">Validators</h5>
<div class="paragraph">
<p>Three variables <code>eldev-release-test-local</code>,
<code>eldev-release-test-other-emacses</code> and
<code>eldev-release-test-docker-images</code> let you configure local
<a href="#testing">testing</a> before releasing.  Standard configuration includes
no testing and Eldev simply relies on you knowing that the code is
bug-free, e.g. from <a href="#continuous-integration">continuous integration</a>
results.</p>
</div>
<div class="paragraph">
<p>In addition to the four standard validation steps, you can define
additional <em>validators</em> by modifying hook <code>eldev-release-validators</code>.
This lets you perform additional checks when releasing your project,
e.g. checking if the documentation is up-to-date.  Macro
<code>eldev-call-process</code> is particularly useful for implementing those in
case you need to invoke external (i.e. non-Elisp) tools.</p>
</div>
<h5 id="_preparing_the_release" class="discrete">Preparing the release</h5>
<div class="paragraph">
<p>Once validation is complete, Eldev <em>prepares</em> the release commit.
Actually, the only standard step for this is updating package version.
This Eldev can do automatically whether you use package headers, or
have a prewritten <code>…-pkg.el</code> file.</p>
</div>
<div class="paragraph">
<p>If you need to perform any other steps, you can use hook
<code>eldev-release-preparators</code>.  Functions hooked here may do whatever is
needed for your project.  Any changes in the registered VCS files will
be included into the commit.  However, if you create another file, you
need to register it by VCS first.</p>
</div>
<h5 id="_post_release_commit" class="discrete">Post-release commit</h5>
<div class="paragraph">
<p>Many projects include a <em>post-release commit</em> in their release flow
that e.g. bumps project version to a “snapshot” one, so that it is
always obvious if checked out source code corresponds to an official
release or not.  To enable this for your project, set variable
<code>eldev-release-post-release-commit</code> to t or a function; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(setf eldev-release-post-release-commit
      (lambda (version)
        (let ((eldev-release-min-version-size 3))
          (eldev-release-next-snapshot-version-unless-already-snapshot version))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we say that we do want to bump a version, but only if it is not a
snapshot already (command <code>release</code> lets you create snapshot releases
too).  We also temporarily rebind <code>eldev-release-min-version-size</code> to
ensure that <code>snapshot</code> is added only after the patch (i.e. the third
component) number.  If <code>version</code> is returned unchanged, the
post-release commit is created, but without bumping the version.  If
nil is returned, however, post-release commit is canceled altogether.</p>
</div>
<div class="paragraph">
<p>Like with the main commit, you can modify hook
<code>eldev-release-post-release-preparators</code> to add special steps.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="undercover-plugin">undercover</h3>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-0.3-8be" alt="Since 0.3"></span> This built-in plugin provides integration with
<a href="https://github.com/undercover-el/undercover.el">undercover</a> tool that generates coverage reports for
your tests.  It is active only for <a href="#testing">command <code>test</code></a>.  By
default, behavior of the tool is unaltered (with the exception that
reports are not merged), so effectively it will do nothing unless run
on a supported <a href="#continuous-integration">continuous integration</a>
server.</p>
</div>
<div class="paragraph">
<p>To have your project’s code coverage statistics automatically gathered
during continuous integration, all you need to do is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Activate the plugin: add <code>(eldev-use-plugin 'undercover)</code> to your
project’s file <code>Eldev</code>.</p>
</li>
<li>
<p>Make sure that command <code>test</code> is executed during automated testing
(e.g. in file <code>.travis.yml</code>) in <code>as-is</code>, <code>source</code> or <code>built-source</code>
<a href="#loading-modes">loading mode</a>.  If you want, you can run it
again additionally in <code>packaged</code> mode.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The plugin adds two options for command <code>test</code>: <code>--undercover</code> (<code>-u</code>)
and <code>--undercover-report</code> (<code>-U</code>).  First option can be used to
configure the plugin and the tool, the second — to change report
filename.  Value for the option <code>-u</code> should be a comma and/or
space-separated list of any of the following flags:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>auto</code>, <code>on</code> (<code>always</code>), <code>off</code> (<code>never</code>)</dt>
<dd>
<p>whether to generate the report; default value is <code>auto</code>;</p>
</dd>
<dt class="hdlist1"><code>coveralls</code>, <code>simplecov</code>, <code>codecov</code>, <code>text</code></dt>
<dd>
<p>format of the report to generate; default is <code>coveralls</code>;</p>
</dd>
<dt class="hdlist1"><code>merge</code>, <code>restart</code></dt>
<dd>
<p>whether to merge with existing report; note that by default report
is <em>restarted</em>, i.e. existing report file is deleted;</p>
</dd>
<dt class="hdlist1"><code>send</code>, <code>dontsend</code></dt>
<dd>
<p>whether to send the generated report to
<a href="https://coveralls.io/">coveralls.io</a> (only for the suitable format);
default is to send.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Additionally, when <code>eldev-dwim</code> is non-nil, certain flags can affect
each other:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if report format is not set explicitly, it is derived from extension
of report filename if possible: <code>.json</code> for <code>simplecov</code> format,
<code>.txt</code> or <code>.text</code> for a text report; <code>codecov</code> format cannot be set
this way, currently;</p>
</li>
<li>
<p>when requested format is not <code>coveralls</code>, report is always generated
unless <code>auto</code> or <code>off</code> (<code>never</code>) is specified explicitly.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Based on the above, easiest way to generate a local coverage report is
something like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev test -U simplecov.json</pre>
</div>
</div>
<div class="paragraph">
<p>Full help for the plugin can always be checked by running <code>eldev
plugins</code> in a project with the plugin activated.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="filesets">Filesets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Filesets are lists of rules that determine a collection of files
inside given root directory, usually the project directory.  Similar
concepts are present in most build tools, version control systems and
some other programs.  Filesets in Eldev are inspired by Git.</p>
</div>
<div class="paragraph">
<p>Important examples of filesets are variables <code>eldev-main-fileset</code>,
<code>eldev-test-fileset</code> and <code>eldev-standard-excludes</code>.  Default values of
all three are <em>simple filesets</em>, but are not actually restricted to
those: when customizing for your project you can use any valid fileset
as a value for any of these variables.  However, for most cases simple
filesets are all that you really need.</p>
</div>
<div class="sect2">
<h3 id="simple-filesets">Simple filesets</h3>
<div class="paragraph">
<p>From Lisp point of view, a simple fileset is a list of strings.  A
single-string list can also be replaced with that string.  The most
important filesets are <code>eldev-main-fileset</code> and <code>eldev-test-fileset</code>.
Using them you can define which <code>.el</code> files are to be packaged and
which contain tests.  Default values should be good enough for most
projects, but you can always change them in file <code>Eldev</code> if needed.</p>
</div>
<div class="paragraph">
<p>Each rule is a string that matches file path — or its part — relative
to the root directory.  Path elements must be separated with a slash
(<code>/</code>) regardless of your OS, to be machine-independent.  A rule may
contain glob wildcards (<code>*</code> and <code>?</code>) with the usual meaning and also
double-star wildcard (<code>**</code>) that must be its own path element.  It
stands for any number (including zero) of nested subdirectories.
Example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>foo/**/bar-*.el</pre>
</div>
</div>
<div class="paragraph">
<p>matches <code>foo/bar-1.el</code> and <code>foo/x/y/bar-baz.el</code>.</p>
</div>
<div class="paragraph">
<p>If a rule starts with an exclamation mark (<code>!</code>), it is an <em>exclusion</em>
rule.  Files that match it (after the mark is stripped) are excluded
from the result.  Other (“normal”) rules are called <em>inclusion</em> rules.</p>
</div>
<div class="paragraph">
<p>Typically, a rule must match any part of a file path (below the root,
of course).  However, if a rule starts with <code>/</code> or <code>./</code> it is called
<em>anchored</em> and must match beginning of a file path.  For example, rule
<code>./README</code> matches file <code>README</code> in the root directory, but not in any
of its subdirectories.</p>
</div>
<div class="paragraph">
<p>If a rule matches a directory, it also matches all of the files the
directory contains (with arbitrary nesting level).  For example, rule
<code>test</code> also matches file <code>test/foo/bar.el</code>.</p>
</div>
<div class="paragraph">
<p>A rule that ends in a slash directly matches only directories.  But,
in accordance to the previous paragraph, also all files within such
directories.  So, there is a subtle difference: a rule <code>test/</code> won’t
match a file named <code>test</code>, but will match any file within a directory
named <code>test</code>.</p>
</div>
<div class="paragraph">
<p>Finally, note a difference with Git concerning inclusions/exclusions
and subdirectories.  Git manual says: <em>“It is not possible to
re-include a file if a parent directory of that file is excluded.”</em>
Eldev filesets have no such exceptions.</p>
</div>
</div>
<div class="sect2">
<h3 id="composite-filesets">Composite filesets</h3>
<div class="paragraph">
<p>Eldev also supports composite filesets.  They are built using common
set/logic operations and can be nested, i.e. one composite fileset can
include another.  There are currently three types:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>(:and ELEMENT...)</code></dt>
<dd>
<p>A file matches an <code>:and</code> fileset if and only if it matches <em>every</em>
of its <code>ELEMENT</code> filesets.</p>
</dd>
<dt class="hdlist1"><code>(:or ELEMENT...)</code></dt>
<dd>
<p>A file matches an <code>:or</code> fileset if and only if it matches <em>at least
one</em> of its <code>ELEMENT</code> filesets.</p>
</dd>
<dt class="hdlist1"><code>(:not NEGATED)</code></dt>
<dd>
<p>A file matches a <code>:not</code> fileset when it <em>doesn’t match</em> its
<code>NEGATED</code> fileset and vice versa.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_evaluated_filesets">Evaluated filesets</h3>
<div class="paragraph">
<p>Finally, some parts of filesets — but not elements of simple filesets!
— can be evaluated.  An evaluated element can be a variable name (a
symbol) or a form.  When matching, such element will be evaluated
<em>once</em>, before <code>eldev-find-files</code> or <code>eldev-filter-files</code> start actual
work.</p>
</div>
<div class="paragraph">
<p>Result of evaluating such an expression can be an evaluated fileset in
turn — Eldev will keep evaluating elements until results finally
consist of only simple and composite filesets.  To prevent accidental
infinite loops, there is a limit of <code>eldev-fileset-max-iterations</code> on
how many times sequential evaluations can yield symbols or forms.</p>
</div>
<div class="paragraph">
<p>Example of an evaluated fileset can be seen from return value of
<code>eldev-standard-fileset</code> function.  E.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(eldev-standard-fileset 'main)
=&gt; (:and eldev-main-fileset (:not eldev-standard-excludes))</code></pre>
</div>
</div>
<div class="paragraph">
<p>As the result contains references to two variables, they will be
evaluated in turn — and so on, until everything is resolved.</p>
</div>
</div>
<div class="sect2">
<h3 id="modifying-filesets">Modifying filesets</h3>
<div class="paragraph">
<p>Eldev contains quite a few variables with filesets that may be
modified by the projects, for example, <code>eldev-test-fileset</code>,
<code>eldev-standard-excludes</code> or <code>eldev-files-to-package</code>.  To modify
those, you should create a <a href="#composite-filesets">composite fileset</a>
that refers to the previous value.  For example like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">;; Make sure included sample projects are not compiled etc.
(setf eldev-standard-excludes
      `(:or ,eldev-standard-excludes "./samples"))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Previously Eldev documentation and its own source code would use
<code>append</code> or <code>push</code> to modify existing filesets.  This turned out to be
a bad advice, because this implicitly assumes that the modified
filesets are <a href="#simple-filesets">simple</a> and might lead to unexpected
results (stacktraces or filesets that don’t do what is expected) for
any other fileset type.</p>
</div>
<div class="paragraph">
<p><span class="image right"><img src="https://img.shields.io/badge/since-1.2-8be" alt="Since 1.2"></span> Starting with version 1.2 Eldev will print a warning
whenever it detects a “suspicious” modification in any of its standard
filesets, to avoid potential bugs: <code>eldev-files-to-package</code> is no
longer a simple filesets starting with that version, some others may
be changed in the future too.  If your project triggers this warning,
please modify the erroneous code (in file <code>Eldev</code> or <code>Eldev-local</code>) to
be similar to the example above.  If you still get warnings, but are
certain that all fileset-modifying code is correct, you can set
variable <code>eldev-warn-about-suspicious-fileset-var-modifications</code> to
<code>nil</code> in file <code>Eldev</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="extending-eldev">Extending Eldev</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Eldev is written to be not just configurable, but also extensible.  It
makes perfect sense to have additional code in file <code>Eldev</code> — if your
project has uncommon building steps.  And also in
<code>~/.config/eldev/config</code> — if you want a special command for your own
needs, for example.  Or maybe in <code>Eldev-local</code> — if you need something
extra only for one specific project that you maintain.</p>
</div>
<div class="sect2">
<h3 id="hooks">Hooks</h3>
<div class="paragraph">
<p>Eldev defines several hooks executed at different times (more might be
added later).  Due to historical reasons, Eldev doesn’t follow Emacs
naming convention on using <code>-hook</code> only for standard hooks (i.e. those
not accepting any arguments) and <code>-functions</code> in other cases.
Functions for many of the hooks listed below do receive arguments.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>eldev-executing-command-hook (COMMAND)</code></dt>
<dd>
<p>Run before executing any command.  Command name (as a symbol) is
passed to the hook’s functions as the only argument.  This is
always the “canonical” command name, even if it is executed using
an alias.</p>
</dd>
<dt class="hdlist1"><code>eldev-COMMAND-hook</code></dt>
<dd>
<p>Run before executing specific command, functions have no
arguments.  Eldev itself uses it (i.e. in its file <code>Eldev</code>) to
print a disclaimer about its fairly slow tests.</p>
</dd>
<dt class="hdlist1"><span class="image right"><img src="https://img.shields.io/badge/since-0.2-8be" alt="Since 0.2"></span> <code>eldev-load-dependencies-hook (TYPE ADDITIONAL-SETS)</code></dt>
<dd>
<p>Executed after successfully loading dependencies.  Functions are
called with arguments <code>TYPE</code> and <code>ADDITIONAL-SETS</code>.  <code>TYPE</code> is
either <code>t</code> if the project is being loaded for actual use, symbol
<code>load-only</code> if it is loaded only for side effect (e.g. to build a
tree of its dependencies), and <code>nil</code> if invoked from
<code>eldev-load-extra-dependencies</code> (i.e. if the project is not being
loaded at all: only some additional sets).  The second is a list
of <a href="#additional-dependencies">additional dependency sets</a>.</p>
</dd>
<dt class="hdlist1"><span class="image right"><img src="https://img.shields.io/badge/since-0.6-8be" alt="Since 0.6"></span> <code>eldev-before-loading-dependencies-hook (TYPE ADDITIONAL-SETS)</code></dt>
<dd>
<p>Similar to the previous hook, but called <em>before</em> dependencies are
loaded.  Function arguments are the same.</p>
</dd>
<dt class="hdlist1"><span class="image right"><img src="https://img.shields.io/badge/since-0.1.1-8be" alt="Since 0.1.1"></span> <code>eldev-build-system-hook</code></dt>
<dd>
<p>Hook executed whenever build system is used.  This is useful since
at least commands <code>build</code>, <code>compile</code> and <code>package</code> invoke the
build system: it would be impractical to add the same function to
all three hooks.</p>
</dd>
<dt class="hdlist1"><span class="image right"><img src="https://img.shields.io/badge/since-0.2-8be" alt="Since 0.2"></span> <code>eldev-test-FRAMEWORK-hook (SELECTORS)</code></dt>
<dd>
<p>Called immediately before executing tests with given framework
(<a href="#ert">ERT</a>, <a href="#buttercup">Buttercup</a>, <a href="#ecukes">Ecukes</a>).
Functions on the hook get passed <code>SELECTORS</code> as the only argument.
At this point project dependencies and additional set <code>test</code> will
have been loaded already, so functions can <code>require</code> features from
the project.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_writing_builders">Writing builders</h3>
<div class="paragraph">
<p>Eldev build system provides standard builders that cover all basic
needs of Elisp packages.  However, some projects have uncommon build
steps.  Instead of writing custom shell scripts, you can integrate
them into the overall build process — which also simplifies further
development.</p>
</div>
<div class="paragraph">
<p>An example of a project with additional build steps is Eldev itself.
Its executable(s) are combined from executable template that is
OS-specific and a common Elisp bootstrapping script.  For example,
<code>bin/eldev</code> is generated from files <code>bin/eldev.in</code> and
<code>bin/bootstrap.el.part</code>.  However, only the first file counts as the
source; see how function <code>eldev-substitute</code> works.</p>
</div>
<div class="paragraph">
<p>There is a simple builder for this in file <code>Eldev</code> of the project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(eldev-defbuilder eldev-builder-preprocess-.in (source target)
  :short-name     "SUBST"
  :message        source-and-target
  :source-files   "*.in"
  :targets        (".in" -&gt; "")
  :collect        ":default"
  :define-cleaner (eldev-cleaner-preprocessed
                   "Delete results of preprocessing `.in' files.  This is specific
to Eldev itself."
                   :aliases prep)
  (let ((modes (file-modes target)))
    (eldev-substitute source target)
    (when (or modes (string-prefix-p "bin/" target))
      (set-file-modes target (or modes #o755)))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here <code>eldev-defbuilder</code> is a macro much like <code>defun</code>.  It defines an
Elisp function named <code>eldev-builder-preprocess-.in</code> and registers it
with parameters (the keyword lines before the body) as an Eldev
builder.  Predictably, list <code>(source target)</code> specifies function
arguments.</p>
</div>
<div class="paragraph">
<p>Let’s skip the keywords for a bit and have a look at the body.  It
works exactly like in a normal Elisp function.  Its job is to generate
<code>target</code> from <code>source</code> using builder-specific means.  This particular
builder calls function <code>eldev-substite</code> that does the actual work
(this function is available also to your project, should you need it).
But your builders could do whatever you want, including launching
external processes (C/C++ compiler, a Python script, etc.) and using
anything from Elisp repertoire.  Note that return value of the body is
ignored.  If building the target fails, builder should signal an
error.</p>
</div>
<div class="paragraph">
<p>Now back to the keyword parameters.  As you can see, they all have a
name and exactly one value after it.  First comes parameter
<code>:short-name</code>.  It specifies what you see in the target tree of the
project, i.e. builder’s name for the user.  It is not required;
without it Eldev would have used <code>preprocess-.in</code> as user-visible
name.</p>
</div>
<div class="paragraph">
<p>Next parameter is <code>:message</code>.  It determines what Eldev prints when
the builder is actually invoked.  For example, when byte-compiling,
you’d see messages like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ELC      some-file.el</pre>
</div>
</div>
<div class="paragraph">
<p>That’s because byte-compiling builder has its <code>:message</code> set to
<code>source</code> (the default).  Other valid values are <code>target</code> and
<code>source-and-target</code> (as in the example).  Both <code>source</code> and <code>target</code>
can be pluralized (i.e. <code>sources-and-target</code> is also a valid value),
but singular/plural is not important in this case as both work
identically.  Finally, value of <code>:message</code> can be a function, in which
case it is called with the same arguments as the builder itself and
should return a string.</p>
</div>
<div class="paragraph">
<p>Value of <code>:source-files</code> parameter must be a <a href="#filesets">fileset</a>.  In
the above example, fileset consists of only one simple rule — which is
actually enough in most cases, — but it could also be much more
complicated.  All files that match the fileset and do not match
<code>eldev-standard-excludes</code> will be processed using this builder.</p>
</div>
<div class="paragraph">
<p>Parameter <code>:targets</code> defines the rule used to construct target names
out of sources matched by <code>:source-files</code>.  There are several ways to
define this rule, we’ll consider them in <a href="#target-rules">their own
subsection</a>.</p>
</div>
<div class="paragraph">
<p>Keyword <code>:collect</code> determines how targets generated by this builder
are “collected” into virtual targets.  In the example all such targets
are simply added to the virtual target <code>:default</code>.  However, here too
we have several other possibilities, which will be described
<a href="#collecting-virtual-targets">later</a>.</p>
</div>
<div class="paragraph">
<p>Finally, keyword <code>:define-cleaner</code> provides a simple way of linking
builders with the <a href="#cleaning">cleaning system</a>.</p>
</div>
<div class="paragraph">
<p>Another important keyword is <code>:type</code>.  It is not used here only
because the example builder is of the default and most common type
that generates one target for each source file.  All possible types
are: <code>one-to-one</code> (the default), <code>one-to-many</code> (several targets from
one source file), <code>many-to-one</code> and <code>many-to-many</code>.  If you write a
builder of a non-default type, be aware that it will be called with a
list of strings instead of a single string as one or both of its
arguments, as appropriate.  You should probably also name them in
plural in the definition in this case, to avoid confusion.</p>
</div>
<div class="sect3">
<h4 id="target-rules">Target rules</h4>
<div class="paragraph">
<p>Target rules define which target(s) will be built from given
source(s).  There are several ways to define a target rule.  Yet more
can be added in the future as real-world needs accumulate.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>TARGET</code></dt>
<dd>
<p>All the sources will be passed together as a list to the builder
to generate one <code>TARGET</code>.  This is suitable for <code>many-to-one</code>
builders.</p>
</dd>
<dt class="hdlist1"><code>(TARGET-1 [TARGET-2 [...]])</code></dt>
<dd>
<p>Build several <code>TARGETS</code> out of all the sources.  This is for
<code>many-to-many</code> and <code>one-to-many</code> builders.</p>
</dd>
<dt class="hdlist1"><code>(SOURCE-SUFFIX -&gt; TARGET-SUFFIX)</code></dt>
<dd>
<p>Build target name from source name by replacing filename suffixes.
<code>SOURCE-SUFFIX</code> can also be a list of strings, in which case any
suffix from the list will be replaced.  This is the type of target
rule you can see in the example and is suitable for <code>one-to-one</code>
builders.  Another use of this rule type could be seen in
byte-compiling builder:</p>
<div class="literalblock">
<div class="content">
<pre>:targets        (".el" -&gt; ".elc")</pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>And the most powerful of all target rules: a function (can be a lambda
form or a function name).  It is called with a list of sources (even
if the builder is of <code>one-to-one</code> or <code>one-to-many</code> type) and must
return one of the types enumerated above.</p>
</div>
</div>
<div class="sect3">
<h4 id="collecting-virtual-targets">Collecting into virtual targets</h4>
<div class="paragraph">
<p>Real targets generated by the builders can optionally be combined into
virtual targets.  The latter are used to easily build all real targets
of the same type; some (<code>:default</code>, <code>:compile</code> etc.)  also have
special meaning to certain commands.</p>
</div>
<div class="paragraph">
<p>Like with the target rules, there are several ways to collect the
targets.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>VIRTUAL-TARGET</code></dt>
<dd>
<p>All real targets generated by the builder are combined into given
<code>VIRTUAL-TARGET</code>.  This is what you can see in the example.</p>
</dd>
<dt class="hdlist1"><code>(VIRTUAL-TARGET-1 [VIRTUAL-TARGET-2 [... VIRTUAL-TARGET-N]])</code></dt>
<dd>
<p>Combine the real targets into <code>VIRTUAL-TARGET-N</code>, then put it to
the preceding virtual target and so on.  This format is currently
unused in standard Eldev builders.  It can generate target trees
of this form:</p>
<div class="openblock">
<div class="content">
<div class="literalblock">
<div class="content">
<pre>:gen-files
    :gen-sources
        :gen-el
            foo.el.in
            bar.el.in</pre>
</div>
</div>
<div class="paragraph">
<p>It is expected (even if not required) that a different builder adds
another branch to the tree, actually making it useful.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1"><code>(ENTRY&#8230;&#8203;)</code>, each <code>ENTRY</code> being <code>(REAL-TARGETS VIRTUAL-TARGETS)</code></dt>
<dd>
<p>Both of <code>REAL-TARGETS</code> and <code>VIRTUAL-TARGETS</code> must be either a list
or a single target string.  For each <code>ENTRY</code> this repeats the
logic of one of the two formats above, but instead of all targets
for the builder uses only those listed in <code>REAL-TARGETS</code> for the
<code>ENTRY</code>.  This is not often needed, but can be useful if builder’s
targets come in two or more substantially different kinds.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Like with <a href="#target-rules">target rules</a>, you can specify a function
here.  Such a function gets called with a list of real targets and
must return a collection rule in one of the formats listed above.</p>
</div>
</div>
<div class="sect3">
<h4 id="_summary">Summary</h4>
<div class="paragraph">
<p>To define a builder you need to write an Elisp function that generates
target(s) from source(s).  If it processes multiple sources at once or
generates multiple targets, give it the appropriate <code>:type</code>.  Write a
fileset that matches its <code>:source-files</code> and a rule to determine
target names from those — parameter <code>:targets</code>.  If you want the
targets grouped together into virtual target(s), add <code>:collect</code>
keyword.  You should probably also add a <code>:define-cleaner</code> that
removes generated targets.</p>
</div>
<div class="paragraph">
<p>Parameters <code>:name</code>, <code>:short-name</code>, <code>:message</code> and <code>:briefdoc</code> are all
fully presentational and thus not very important.  But if you want to
write a nice and polished builder, investigate them too.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_commands_and_options">Adding commands and options</h3>
<div class="paragraph">
<p>Eldev has lots of standard commands, but sometimes you need to define
yet more.  Commands should generally be defined for things that cannot
be reformulated in terms of building targets.  If a command would just
create a file, e.g. extract documentation from source code, an
additional builder would be more suitable.</p>
</div>
<div class="paragraph">
<p>Defining a command is not much more complicated than defining a normal
Elisp function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(eldev-defcommand mypackage-parrot (&amp;rest parameters)
  "Repeat parameters from the command line."
  :parameters     "TEXT-TO-PARROT"
  :aliases        (copycat ape)
  (unless parameters
    (signal 'eldev-wrong-command-usage `(t "Nothing to say")))
  (eldev-output "%s" (mapconcat #'identity parameters " ")))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Macro <code>eldev-defcommand</code> works much like <code>defun</code>, but additionally it
adds the new function to the list of Eldev command handlers.  New
command receives name built from the function name by removing package
prefix.  If that doesn’t produce the needed result in your case
(e.g. if package prefix is two words in your project), you can always
specify name explicitly by using <code>:command</code> parameter.  You can also
give your command any number of aliases, as shown above.</p>
</div>
<div class="paragraph">
<p>Keyword <code>:parameter</code> describes what the command expects to see on the
command line.  It is used when invoking <code>eldev help COMMAND</code> to
improve documentation: all commands are automatically documented.  The
short one-liner for <code>eldev help</code> is derived from the function’s
documentation by taking the first sentence.  If this is not good
enough in your case, use keyword <code>:briefdoc</code> to set it explicitly.</p>
</div>
<div class="paragraph">
<p>When command is invoked from command line, Eldev calls the
corresponding function, passing all remaining parameters to it as
strings.  The example command above just parrots the parameters back
at user, in accordance to its name.</p>
</div>
<div class="sect3">
<h4 id="_defining_options">Defining options</h4>
<div class="paragraph">
<p>You have probably noticed that the command function we’ve defined
doesn’t accept any options.  In fact, this is true for all commands in
Eldev: options are not <em>passed</em> to them.  Eldev takes a different
approach: whenever a (recognized) option is encountered on the command
line, appropriate function is called, which is supposed to alter
global state.  This way it is easy to share options between multiple
commands when needed.</p>
</div>
<div class="paragraph">
<p>So, with that in mind, let’s expand our example command with an
option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-lisp" data-lang="lisp">(defvar mypackage-parrot-colorize-as nil)

(eldev-defcommand mypackage-parrot (&amp;rest parameters)
  "Repeat parameters from the command line.  If you want, I can even
colorize them!"
  :parameters     "TEXT-TO-PARROT"
  :aliases        (copycat ape)
  (unless parameters
    (signal 'eldev-wrong-command-usage `(t "Nothing to say")))
  (let ((text (mapconcat #'identity parameters " ")))
     (when mypackage-parrot-colorize-as
       (setf text (eldev-colorize text mypackage-parrot-colorize-as)))
     (eldev-output "%s" text)))

(eldev-defoption mypackage-parrot-colorize (&amp;optional style)
  "Apply given STYLE to the parroted text (`section' if not specified)"
  :options        (-c --colorize)
  :optional-value STYLE
  :for-command    parrot
  (setf mypackage-parrot-colorize-as (intern (or style "section"))))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Definition of <code>mypackage-parrot</code> is updated, but there is nothing
Eldev-specific here.  Let’s rather have a look at the option
definition.</p>
</div>
<div class="paragraph">
<p>Unlike for command function, name of option function is not important.
Instead, how the option looks like on the command line is determined
by <code>:options</code> keyword.  It can specify any number of alternatives, but
they all must be either short-style (single <code>-</code> followed by one
letter) or long-style (<code>--</code> followed by a longer name) options.  Some
options take a value; it is determined by parameter <code>:optional-value</code>
or <code>:value</code> (if the value is mandatory) and must match arguments in
function definition.</p>
</div>
<div class="paragraph">
<p>Options can be either global or command-specific.  In the latter case
— the one you’ll typically need — you define to which command(s) the
option applies using <code>:for-command</code> parameter.  In our case its value
is a single command, but it can also be a list of commands.</p>
</div>
<div class="paragraph">
<p>To test how the new option works, run:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ eldev parrot -c Repeat this</pre>
</div>
</div>
<div class="paragraph">
<p>It should print text “Repeat this” in bold, unless you’ve disabled
output colorizing.</p>
</div>
<div class="paragraph">
<p>Note that the command doesn’t repeat “-c”, even though it appears on
the command line.  That’s because Eldev doesn’t pass the options as
parameters to commands: only non-option arguments remain.</p>
</div>
<div class="paragraph">
<p>Documentation (i.e. output of <code>eldev help parrot</code>) for the command we
defined above now automatically lists the accepted option:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Usage: eldev [OPTION...] parrot TEXT-TO-PARROT

Command aliases: copycat, ape

Options:
  -c, --colorize[=STYLE]
                        Apply given STYLE to the parroted text (‘section’ if
                        not specified)

Repeat parameters from the command line.  If you want, I can even
colorize them!</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_custom_test_runners">Custom test runners</h3>
<div class="paragraph">
<p>FIXME</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_influential_environment_variables">Influential environment variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A few environment variables can affect Eldev’s behavior.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>EMACS</code> or <code>ELDEV_EMACS</code></dt>
<dd>
<p>Use given Emacs executable (also for any child processes).  If not
specified, this defaults to just <code>emacs</code>, which is expected
somewhere in <code>PATH</code>.</p>
</dd>
<dt class="hdlist1"><code>ELDEV_LOCAL</code></dt>
<dd>
<p>Load Eldev Elisp code from given directory (usually a Git clone of
source tree) instead of the normal bootstrapping from MELPA.
Should not be needed normally, only when developing Eldev itself.</p>
</dd>
<dt class="hdlist1"><code>ELDEV_DIR</code></dt>
<dd>
<p>Directory where user’s configuration file, Eldev’s bootstrapping
files etc. are located.  When not set, configuration files are
looked up either in <code>~/.eldev</code> if that exists, else in
<code>~/.config/eldev</code>; runtime files are placed either in <code>~/.eldev</code>
or <code>~/.cache/eldev</code>.  Used by Eldev’s own regression tests, should
be of no interest for typical use.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see_also">See also</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Other build tools you might want to use instead of Eldev:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/cask/cask">Cask</a> — the most established Emacs project management
tool.</p>
</li>
<li>
<p><a href="https://github.com/alphapapa/makem.sh">makem.sh</a> — a shell script that performs many common
Elisp development tasks; must be copied to your project.</p>
</li>
<li>
<p><a href="https://github.com/emacs-eask/cli">Eask</a> — a build tool that can be seen as a successor to
Cask; uses a similar project description file.</p>
</li>
<li>
<p><a href="https://github.com/conao3/keg.el">Keg</a> — another alternative to Cask; likewise, uses a
similar project description file.</p>
</li>
<li>
<p><a href="https://gitea.petton.fr/DamienCassou/makel">makel</a> — a prebuilt <code>Makefile</code> with typical targets
useful to Elisp projects.</p>
</li>
<li>
<p><a href="https://github.com/vermiculus/emake.el">EMake</a> — build tool that combines Elisp with GNU Make.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Projects and services that can otherwise help you with developing your
Elisp code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/rejeep/evm">EVM</a> — Emacs version manager; has special support for
Travis CI.</p>
</li>
<li>
<p><a href="https://github.com/purcell/nix-emacs-ci">nix-emacs-ci</a> — installer of different Emacs
versions that uses Nix and Cachix; useful for continuous
integration.</p>
</li>
<li>
<p><a href="https://help.github.com/en/actions">GitHub workflows</a> — a part of GitHub available
to any hosted project, which can be used for
<a href="#github-workflows">continuous integration</a> among other things.</p>
</li>
<li>
<p><a href="https://travis-ci.org/">Travis CI</a> — continuous integration service, the most
used one for Elisp projects; Eldev has <a href="#travis-ci">additional
support</a> for it.</p>
</li>
<li>
<p><a href="https://circleci.com/">CircleCI</a> — another continuous integration service;
Eldev provides <a href="#circle-ci">a special installation script</a> for it.</p>
</li>
<li>
<p><a href="https://coveralls.io/">Coveralls</a> — web service to help you track your
code coverage over time; can be integrated with Eldev using
<a href="#undercover-plugin">a plugin</a>;</p>
</li>
<li>
<p><a href="https://github.com/undercover-el/undercover.el">undercover</a> — a tool for generating test coverage
reports for Elisp code; also see Coveralls above.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-06-19 17:43:47 UTC
</div>
</div>
</body>
</html>